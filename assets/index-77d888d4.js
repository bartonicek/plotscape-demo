(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();var fn=Object.defineProperty,dn=(n,t,e)=>t in n?fn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,h=(n,t,e)=>(dn(n,typeof t!="symbol"?t+"":t,e),e);const mn=(n,t)=>n===t,Gt=Symbol("solid-proxy"),kt={equals:mn};let Me=je;const H=1,St=2,Ne={owned:null,cleanups:null,context:null,owner:null};var X=null;let It=null,N=null,R=null,W=null,Pt=0;function yn(n,t){const e=N,s=X,r=n.length===0,o=t===void 0?s:t,a=r?Ne:{owned:null,cleanups:null,context:o?o.context:null,owner:o},i=r?n:()=>n(()=>U(()=>jt(a)));X=a,N=null;try{return st(i,!0)}finally{N=e,X=s}}function E(n,t){t=t?Object.assign({},kt,t):kt;const e={value:n,observers:null,observerSlots:null,comparator:t.equals||void 0},s=r=>(typeof r=="function"&&(r=r(e.value)),Pe(e,r));return[Oe.bind(e),s]}function _(n,t,e){const s=_t(n,t,!1,H);ut(s)}function At(n,t,e){Me=vn;const s=_t(n,t,!1,H);(!e||!e.render)&&(s.user=!0),W?W.push(s):ut(s)}function it(n,t,e){e=e?Object.assign({},kt,e):kt;const s=_t(n,t,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=e.equals||void 0,ut(s),Oe.bind(s)}function wt(n){return st(n,!1)}function U(n){if(N===null)return n();const t=N;N=null;try{return n()}finally{N=t}}function Oe(){if(this.sources&&this.state)if(this.state===H)ut(this);else{const n=R;R=null,st(()=>Lt(this),!1),R=n}if(N){const n=this.observers?this.observers.length:0;N.sources?(N.sources.push(this),N.sourceSlots.push(n)):(N.sources=[this],N.sourceSlots=[n]),this.observers?(this.observers.push(N),this.observerSlots.push(N.sources.length-1)):(this.observers=[N],this.observerSlots=[N.sources.length-1])}return this.value}function Pe(n,t,e){let s=n.value;return(!n.comparator||!n.comparator(s,t))&&(n.value=t,n.observers&&n.observers.length&&st(()=>{for(let r=0;r<n.observers.length;r+=1){const o=n.observers[r],a=It&&It.running;a&&It.disposed.has(o),(a?!o.tState:!o.state)&&(o.pure?R.push(o):W.push(o),o.observers&&De(o)),a||(o.state=H)}if(R.length>1e6)throw R=[],new Error},!1)),t}function ut(n){if(!n.fn)return;jt(n);const t=X,e=N,s=Pt;N=X=n,gn(n,n.value,s),N=e,X=t}function gn(n,t,e){let s;try{s=n.fn(t)}catch(r){return n.pure&&(n.state=H,n.owned&&n.owned.forEach(jt),n.owned=null),n.updatedAt=e+1,Re(r)}(!n.updatedAt||n.updatedAt<=e)&&(n.updatedAt!=null&&"observers"in n?Pe(n,s):n.value=s,n.updatedAt=e)}function _t(n,t,e,s=H,r){const o={fn:n,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:X,context:X?X.context:null,pure:e};return X===null||X!==Ne&&(X.owned?X.owned.push(o):X.owned=[o]),o}function Ct(n){if(n.state===0)return;if(n.state===St)return Lt(n);if(n.suspense&&U(n.suspense.inFallback))return n.suspense.effects.push(n);const t=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<Pt);)n.state&&t.push(n);for(let e=t.length-1;e>=0;e--)if(n=t[e],n.state===H)ut(n);else if(n.state===St){const s=R;R=null,st(()=>Lt(n,t[0]),!1),R=s}}function st(n,t){if(R)return n();let e=!1;t||(R=[]),W?e=!0:W=[],Pt++;try{const s=n();return wn(e),s}catch(s){e||(W=null),R=null,Re(s)}}function wn(n){if(R&&(je(R),R=null),n)return;const t=W;W=null,t.length&&st(()=>Me(t),!1)}function je(n){for(let t=0;t<n.length;t++)Ct(n[t])}function vn(n){let t,e=0;for(t=0;t<n.length;t++){const s=n[t];s.user?n[e++]=s:Ct(s)}for(t=0;t<e;t++)Ct(n[t])}function Lt(n,t){n.state=0;for(let e=0;e<n.sources.length;e+=1){const s=n.sources[e];if(s.sources){const r=s.state;r===H?s!==t&&(!s.updatedAt||s.updatedAt<Pt)&&Ct(s):r===St&&Lt(s,t)}}}function De(n){for(let t=0;t<n.observers.length;t+=1){const e=n.observers[t];e.state||(e.state=St,e.pure?R.push(e):W.push(e),e.observers&&De(e))}}function jt(n){let t;if(n.sources)for(;n.sources.length;){const e=n.sources.pop(),s=n.sourceSlots.pop(),r=e.observers;if(r&&r.length){const o=r.pop(),a=e.observerSlots.pop();s<r.length&&(o.sourceSlots[a]=s,r[s]=o,e.observerSlots[s]=a)}}if(n.owned){for(t=n.owned.length-1;t>=0;t--)jt(n.owned[t]);n.owned=null}if(n.cleanups){for(t=n.cleanups.length-1;t>=0;t--)n.cleanups[t]();n.cleanups=null}n.state=0}function xn(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function Re(n,t=X){throw xn(n)}function bn(n,t){return U(()=>n(t||{}))}function vt(){return!0}const $n={get(n,t,e){return t===Gt?e:n.get(t)},has(n,t){return t===Gt?!0:n.has(t)},set:vt,deleteProperty:vt,getOwnPropertyDescriptor(n,t){return{configurable:!0,enumerable:!0,get(){return n.get(t)},set:vt,deleteProperty:vt}},ownKeys(n){return n.keys()}};function Ut(n){return(n=typeof n=="function"?n():n)?n:{}}function kn(){for(let n=0,t=this.length;n<t;++n){const e=this[n]();if(e!==void 0)return e}}function Sn(...n){let t=!1;for(let o=0;o<n.length;o++){const a=n[o];t=t||!!a&&Gt in a,n[o]=typeof a=="function"?(t=!0,it(a)):a}if(t)return new Proxy({get(o){for(let a=n.length-1;a>=0;a--){const i=Ut(n[a])[o];if(i!==void 0)return i}},has(o){for(let a=n.length-1;a>=0;a--)if(o in Ut(n[a]))return!0;return!1},keys(){const o=[];for(let a=0;a<n.length;a++)o.push(...Object.keys(Ut(n[a])));return[...new Set(o)]}},$n);const e={},s={},r=new Set;for(let o=n.length-1;o>=0;o--){const a=n[o];if(!a)continue;const i=Object.getOwnPropertyNames(a);for(let p=0,m=i.length;p<m;p++){const f=i[p];if(f==="__proto__"||f==="constructor")continue;const d=Object.getOwnPropertyDescriptor(a,f);if(!r.has(f))d.get?(r.add(f),Object.defineProperty(e,f,{enumerable:!0,configurable:!0,get:kn.bind(s[f]=[d.get.bind(a)])})):(d.value!==void 0&&r.add(f),e[f]=d.value);else{const v=s[f];v?d.get?v.push(d.get.bind(a)):d.value!==void 0&&v.push(()=>d.value):e[f]===void 0&&(e[f]=d.value)}}}return e}function he(n){return n}function An(n){return n()}function Xe(){}function Y(n){return()=>n}function pe(n,t){return t}function fe(){return{}}function Cn(n){return n.toString()}function Et(n){return parseInt(n,10)}function Mt(n,t){return n-t}function Ft(n,t){return n.localeCompare(t,"en",{numeric:!0})}function Zt(n,t){const e=Math.abs(t-n)+1,s=t>=n?1:-1;return Array.from(Array(e),(r,o)=>n+s*o)}function Q(n){let[t,e]=[1/0,-1/0];for(let s=0;s<n.length;s++)t=Math.min(t,n[s]),e=Math.max(e,n[s]);return[t,e]}function Ln(n,t){const e=[...n];return e.sort((s,r)=>Math.sign(t[e.indexOf(s)]-t[e.indexOf(r)])),e}function z(n){return Reflect.ownKeys(n)}function Be(n){const t=[];for(const e of z(n))t.push(n[e]);return t}function Z(n){const t=[];for(const e of z(n))t.push([e,n[e]]);return t}function En(n){const t={};for(const[e,s]of Z(n))t[e]=s.value();return t}async function Mn(n){return await(await fetch(n)).json()}function Vt(n,t){let e=0;return(...s)=>{const r=new Date().getTime();r-e<t||(e=r,n(...s))}}function Jt(n,t,e,s){const[r,o]=Q(n),[a,i]=Q(t),[p,m]=Q(e),[f,d]=Q(s);return!(o<p||r>m||i<f||a>d)}class at{constructor(t,e){h(this,"row"),h(this,"indexfn"),this.index=e,this.indexfn=()=>this.index,this.row=t.row(this.indexfn)}static from(t,e){return new at(t,e)}values(){return this.row}slide(){return this.index++,this}}const $t=["parent","positions","stack","layer","group","transient"].map(Symbol),[de,q,xt,Dt,Rt,Xt]=$t;class ht{constructor(t){this.valueLike=t}static of(t){return new ht(t)}value(){return this.valueLike.value()}toVariable(){return I.from([this.value()])}}class pt{constructor(t,e){this.array=t,this.indexfn=e}static of(t,e){return new pt(t,e)}value(){return this.array[this.indexfn()]}}const Ht=class{constructor(t,e){h(this,"name"),h(this,"meta"),this.array=t,this.name=e?.name}empty(){this.array.length=0}values(){return this.array}ith(t){return ht.of(pt.of(this.array,t))}push(t){return this.array.push(t.value())}isOfLength(t){return this.array.length===t}};h(Ht,"from",n=>new Ht(n));let I=Ht;class Bt{constructor(t){this.valueLike=t}static of(t){return new Bt(t)}value(){return this.valueLike.value()}toVariable(){return ft.from([this.value()])}}const Nn={sort:!0};class ft{constructor(t,e){h(this,"array"),h(this,"name"),h(this,"meta"),h(this,"empty",()=>{this.array.length=0,this.meta.values.length=0}),e={...Nn,...e},this.array=t.map(Cn),this.name=e?.name,this.meta={values:Array.from(new Set(this.array))},e.sort&&this.meta.values.sort(Ft)}static from(t,e){return new ft(t,e)}values(){return this.array}ith(t){return Bt.of(pt.of(this.array,t))}push(t){const e=t.value();return this.array.push(e),this.meta.values.indexOf(e)===-1&&(this.meta.values.push(e),this.meta.values.sort(Ft)),this.array.length}isOfLength(t){return this.array.length===t}factor(t){return F.from(this,t)}}class Nt{constructor(t,e){h(this,"name"),h(this,"meta"),this.variable=t,this.translatefn=e,this.name=this.variable.name,this.meta=this.variable.meta}static from(t,e){return new Nt(t,e)}empty(){this.variable.empty()}ith(t){return this.variable.ith(this.translatefn(t))}values(){return this.variable.values()}push(t){return this.variable.push(t)}isOfLength(t){return this.variable.isOfLength(t)}}class bt{constructor(t,e,s){this._uniqueIndices=t,this._indices=e,this._data=s}cardinality(){return this._uniqueIndices.size}*uniqueIndices(){yield*this._uniqueIndices}*indices(){yield*this._indices}data(){return this._data}}class dt{constructor(t){this.val=t}static of(t){return new dt(t)}value(){return this.val}}class Qt{constructor(){}static of(){return new Qt}value(){}toVariable(){return I.from([])}}class mt{constructor(t){this.valueLike=t}static of(t){return new mt(t)}value(){return this.valueLike.value()}toVariable(){return et.from([this.value()])}inc(){return j(this.value()+1)}dec(){return j(this.value()-1)}add(t){return j(this.value()+t.value())}minus(t){return j(this.value()-t.value())}times(t){return j(this.value()*t.value())}divideBy(t){return j(this.value()/t.value())}}const j=n=>mt.of(dt.of(n)),te=n=>ht.of(dt.of(n)),On=()=>Qt.of(),Pn=n=>n instanceof mt||n instanceof Bt||n instanceof ht;class jn{constructor(t){this.n=t}cardinality(){return this.n}*uniqueIndices(){let t=0;for(;t<this.n;)yield t++}*indices(){yield*this.uniqueIndices()}data(){const t=Y(this.n),e=()=>{},s=a=>a===this.n,r=a=>{if(a()<this.n)return te(new Set([a()]))},o={ith:r,push:t,values:()=>{const a=Array(this.n);for(let i=0;i<this.n;i++)a[i]=r(Y(i));return a},empty:e,isOfLength:s};return new P(this.n,{[q]:o})}}class Dn{constructor(t){this.n=t}cardinality(){return 1}*uniqueIndices(){yield 0}*indices(){let t=0;for(;t<this.n;)yield 0,t++}data(){const t=Y(1),e=()=>{},s=a=>a===this.n,r=a=>{if(a()===0)return te(new Set(Zt(0,this.n)))},o={ith:r,push:t,values:()=>{const a=Array(this.n);for(let i=0;i<this.n;i++)a[i]=r(Y(i));return a},empty:e,isOfLength:s};return new P(1,{[q]:o})}}class F{static mono(t){return new Dn(t)}static iso(t){return new jn(t)}static computed(t,e,s){return new bt(t,e,s)}static from(t,e){const{array:s,meta:r}=t;e||(e=r.values.sort(Ft));const o=new Set(Zt(0,e.length)),a=[],i={};for(let m=0;m<s.length;m++){const f=e.indexOf(s[m].toString());i[f]||(i[f]=new Set),i[f].add(m),a.push(f)}const p=new P(e.length,{label:ft.from(e,{name:t.name}),[q]:I.from(Object.values(i))});return new bt(o,a,p)}static bin(t,e,s){const[r,o]=Q(t),a=e?Math.ceil((o-r)/e)+1:10;e=e??(o-r)/(a-1),s=s??r;const i=r-e+(s-r)%e,p=o+e-(o-s)%e,m=Array(a+2);m[0]=i,m[m.length-1]=p;for(let x=1;x<m.length-1;x++)m[x]=i+x*e;const f=new Set,d=[],v={};for(let x=0;x<t.length;x++){const k=m.findIndex(S=>S>=t[x])-1;v[k]||(v[k]=new Set),v[k].add(x),f.add(k),d.push(k)}const u=Array.from(f).sort(Mt),l=new Set,c={};for(const[x,k]of Object.entries(u)){const S=Et(x);l.add(S),c[k]=S}const w=d;for(let x=0;x<w.length;x++)w[x]=c[w[x]];const g=[],$=[];for(const x of u)g.push(m[x]),$.push(m[x+1]);const y={binMin:et.from(g),binMax:et.from($),[q]:I.from(Object.values(v))},b=new P(l.size,y);return new bt(l,w,b)}static product(t,e){const s=e.cardinality(),r=new Set,o=[],a={},i={},p={},m=t.indices(),f=e.indices();let d=m.next(),v=f.next(),u=0;for(;!d.done;){const C=d.value*s+v.value;a[C]||(a[C]=new Set),a[C].add(u),r.add(C),o.push(C),i[C]=d.value,p[C]=v.value,d=m.next(),v=f.next(),u++}const l=Array.from(r).sort(Mt),c=new Set,w={},g={},$={};for(const[C,O]of Object.entries(l)){const T=Et(C);c.add(T),w[O]=T,g[T]=i[O],$[T]=p[O]}const y=o;for(let C=0;C<y.length;C++)y[C]=w[y[C]];const b=t.data(),x=e.data(),k={},S=C=>()=>g[C()],L=C=>()=>$[C()];for(const[C,O]of Z(b.cols))k[C]=new Nt(O,S);for(const[C,O]of Z(x.cols))k[C]=new Nt(O,L);k[q]=I.from(Object.values(a));const A=new P(c.size,k);return new bt(c,y,A)}}class et{constructor(t,e){h(this,"name"),h(this,"meta"),this.array=t;const[s,r]=Q(t);this.name=e?.name,this.meta={min:s,max:r}}static from(t){return new et(t)}empty(){this.array.length=0,this.meta.min=1/0,this.meta.max=-1/0}values(){return this.array}ith(t){return mt.of(pt.of(this.array,t))}push(t){const e=t.value();return this.array.push(e),this.meta.min=Math.min(this.meta.min,e),this.meta.max=Math.max(this.meta.max,e),this.array.length}isOfLength(t){return this.array.length===t}bin(t,e){return F.bin(this.array,t.value(),e.value())}}const Rn={numeric:et,discrete:ft,reference:I};class P{constructor(t,e){h(this,"keys"),this.n=t,this.cols=e,this.keys=new Set(z(e))}static from(t,e){return new P(t,e)}static fromRows(t){const e={};for(const r of z(t[0]))t[0][r]&&(e[r]=t[0][r].toVariable());const s=new P(1,e);for(let r=1;r<t.length;r++)s.push(t[r]);return s}static parseCols(t,e){const s={};for(const[r,o]of Z(e))s[r]=new Rn[o](t[r],{name:r});return P.from(Object.values(t)[0].length,s)}empty(){for(const t of z(this.cols))this.cols[t].empty();return this.n=0,this}row(t){const e={};for(const s of this.keys)e[s]=this.cols[s].ith(t);return e}rows(){const t=[];for(let e=0;e<this.n;e++)t.push(this.row(()=>e));return t}push(t){for(const e of z(this.cols))this.cols[e].push(t[e]);return this.n++}unwrapRow(t){return En(this.row(t))}unwrapRows(){const t=[];for(let e=0;e<this.n;e++)t.push(this.unwrapRow(()=>e));return t}select(t){const e=t(this.cols);return P.from(this.n,e)}appendCol(t,e){const s=this.cols;return s[t]=e,this.keys.add(t),P.from(this.n,s)}appendCols(t){if(t.n!=this.n)throw new Error("Dataframes have different number of rows.");const e=this.cols;for(const[s,r]of Z(t.cols))e[s]=r;return new P(this.n,e)}*[Symbol.iterator](){const t=at.from(this,0);yield t.values();for(let e=1;e<this.n;e++)yield t.slide().values()}}const lt=0,[Wt,Xn,Bn,Tn]=[7,6,5,4],zn=n=>n&-5,Yn=n=>n|4,In=[0,1,2,3],Un=I.from([4,3,2,1,4,3,2,1]),Vn=I.from([1,2,3,4,5,6,7,8]),Wn=I.from(Array.from(Array(8),(n,t)=>t<4)),qn=new Set(Zt(0,7));class Gn{constructor(t,e,s){h(this,"data"),h(this,"transientPositions"),h(this,"positionsArray"),h(this,"indices"),h(this,"setIndices"),h(this,"factor"),this.n=t,this.groupS=e,this.selectedS=s;const r=Array.from(Array(8),()=>new Set),o=I.from(r);this.positionsArray=r,this.data=P.from(t,{[q]:o,[Rt]:Un,[Dt]:Vn,[Xt]:Wn}),this.transientPositions=new Set;const a=Array(t).fill(Wt),[i,p]=E(a);this.indices=i,this.setIndices=p,this.factor=()=>F.computed(qn,i(),this.data),At(()=>{const{positionsArray:m,transientPositions:f}=this,[d,v]=[this.selectedS(),U(this.groupS)],u=[...U(this.indices)];if(d.size){for(const l of m)for(const c of d)l.delete(c);if(v===lt){f.clear();for(const l of d){const c=zn(u[l]);u[l]=c,m[c].add(l),f.add(l)}}else for(const l of d)u[l]=v,m[v].add(l);this.setIndices(u)}})}clearAll(){const{n:t,positionsArray:e}=this;for(const s of e)s.clear();for(let s=0;s<t;s++)e[Wt].add(s);this.setIndices(Array(t).fill(Wt))}clearTransient(){const{n:t,positionsArray:e,transientPositions:s}=this,r=[...U(this.indices)];for(const o of In)e[o].clear();for(let o=0;o<t;o++)r[o]=Yn(r[o]);s.clear(),this.setIndices(r)}}const B={axisOffset:5,radius:3,width:.8,alpha:1,colour:"#4682B4",groupColours:["#D1D5DE","#E41A1C","#4DAF4A","#984EA3"],transientColour:"#377EB8",fontsize:16,marginLines:[4,4,2,2],defaultNorm:{x:{lower:.05,upper:.95},y:{lower:.05,upper:.95}}},Te={color:"black",stroke:void 0,alpha:1};function G(n){const{width:t,height:e}=n.canvas.getBoundingClientRect();n.clearRect(0,0,t,e)}const Fn=Te;function ct(n,t,e,s,r,o){const[a,i]=[s-t,r-e],{height:p}=n.canvas.getBoundingClientRect(),m=Object.assign({},Fn,o);n.save(),n.fillStyle=m.color,n.globalAlpha=m.alpha,n.fillRect(t,p-e,a,-i),o!=null&&o.stroke&&(n.strokeStyle=o.stroke,n.strokeRect(t,p-e,a,-i)),n.restore()}const Hn={...Te,radius:B.radius};function me(n,t,e,s){const r=Object.assign({},Hn,s);n.save(),n.fillStyle=r.color,n.globalAlpha=r.alpha,n.beginPath(),n.arc(t,e,r.radius,0,2*Math.PI,!1),n.fill(),r.stroke&&(n.strokeStyle=r.stroke,n.stroke()),n.restore()}function ye(n,t,e,s,r){n.save(),n.translate(e,s),r!=null&&r.vertical&&n.rotate(-Math.PI/2),n.font=`${r?.fontsize??"10"}px ${r?.fontfamily??"Arial"}`,n.fillText(t,0,0),n.translate(-e,-s),n.restore()}const Kn=()=>{const[n,t]=E(lt),[e,s]=E(new Set);return{group:n,selected:e,setGroup:t,setSelected:s}},_n=n=>n.classList.contains("plotscape-scene");class Zn{constructor(t,e){h(this,"nPlots"),h(this,"nCols"),h(this,"nRows"),h(this,"plots"),h(this,"marker"),h(this,"store"),h(this,"keyActions"),h(this,"setRowsCols",(r,o)=>{document.documentElement.style.setProperty("--ncols",o.toString()),document.documentElement.style.setProperty("--nrows",r.toString());for(const a of this.plots)a.resize()}),h(this,"pushPlot",r=>{this.plots.push(r),this.nPlots++,this.nCols=Math.ceil(Math.sqrt(this.nPlots)),this.nRows=Math.ceil(this.nPlots/this.nCols),this.setRowsCols(this.nRows,this.nCols)}),h(this,"deactivateAll",()=>{for(const r of this.plots)r.deactivate()}),h(this,"onMouseDown",r=>{for(const a of this.plots)G(a.contexts.user);const{target:o}=r;o instanceof Element&&_n(o)&&this.deactivateAll()}),h(this,"onDoubleClick",()=>{this.deactivateAll(),this.marker.clearAll(),this.store.setGroup(lt),this.store.setSelected(new Set)}),h(this,"onKeyDown",r=>{var o,a;const i=r.code;(a=(o=this.keyActions)[i])==null||a.call(o)}),h(this,"onKeyUp",()=>{this.store.setGroup(lt)}),this.app=t,this.data=e,this.app.classList.add("plotscape-scene"),this.nPlots=0,this.nCols=0,this.nRows=0;const s=Kn();this.store=s,this.marker=new Gn(e.n,s.group,s.selected),this.plots=[],this.keyActions={Digit1:()=>this.store.setGroup(Xn),Digit2:()=>this.store.setGroup(Bn),Digit3:()=>this.store.setGroup(Tn)},this.app.addEventListener("mousedown",this.onMouseDown),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("dblclick",this.onDoubleClick)}}const Jn=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],ze=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Jn]),Ye=new Set(["innerHTML","textContent","innerText","children"]),Ie=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Qn=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function Ue(n,t){const e=Qn[n];return typeof e=="object"?e[t]?e.$:void 0:e}const Ve=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),ts=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),We={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function es(n,t,e){let s=e.length,r=t.length,o=s,a=0,i=0,p=t[r-1].nextSibling,m=null;for(;a<r||i<o;){if(t[a]===e[i]){a++,i++;continue}for(;t[r-1]===e[o-1];)r--,o--;if(r===a){const f=o<s?i?e[i-1].nextSibling:e[o-i]:p;for(;i<o;)n.insertBefore(e[i++],f)}else if(o===i)for(;a<r;)(!m||!m.has(t[a]))&&t[a].remove(),a++;else if(t[a]===e[o-1]&&e[i]===t[r-1]){const f=t[--r].nextSibling;n.insertBefore(e[i++],t[a++].nextSibling),n.insertBefore(e[--o],f),t[r]=e[o]}else{if(!m){m=new Map;let d=i;for(;d<o;)m.set(e[d],d++)}const f=m.get(t[a]);if(f!=null)if(i<f&&f<o){let d=a,v=1,u;for(;++d<r&&d<o&&!((u=m.get(t[d]))==null||u!==f+v);)v++;if(v>f-i){const l=t[a];for(;i<f;)n.insertBefore(e[i++],l)}else n.replaceChild(e[i++],t[a++])}else a++;else t[a++].remove()}}}const ge="_$DX_DELEGATE";function qe(n,t=window.document){const e=t[ge]||(t[ge]=new Set);for(let s=0,r=n.length;s<r;s++){const o=n[s];e.has(o)||(e.add(o),t.addEventListener(o,ls))}}function Ot(n,t,e){e==null?n.removeAttribute(t):n.setAttribute(t,e)}function Ge(n,t,e,s){s==null?n.removeAttributeNS(t,e):n.setAttributeNS(t,e,s)}function ns(n,t){t==null?n.removeAttribute("class"):n.className=t}function Fe(n,t,e,s){if(s)Array.isArray(e)?(n[`$$${t}`]=e[0],n[`$$${t}Data`]=e[1]):n[`$$${t}`]=e;else if(Array.isArray(e)){const r=e[0];n.addEventListener(t,e[0]=o=>r.call(n,e[1],o))}else n.addEventListener(t,e)}function He(n,t,e={}){const s=Object.keys(t||{}),r=Object.keys(e);let o,a;for(o=0,a=r.length;o<a;o++){const i=r[o];!i||i==="undefined"||t[i]||(we(n,i,!1),delete e[i])}for(o=0,a=s.length;o<a;o++){const i=s[o],p=!!t[i];!i||i==="undefined"||e[i]===p||!p||(we(n,i,!0),e[i]=p)}return e}function Ke(n,t,e){if(!t)return e?Ot(n,"style"):t;const s=n.style;if(typeof t=="string")return s.cssText=t;typeof e=="string"&&(s.cssText=e=void 0),e||(e={}),t||(t={});let r,o;for(o in e)t[o]==null&&s.removeProperty(o),delete e[o];for(o in t)r=t[o],r!==e[o]&&(s.setProperty(o,r),e[o]=r);return e}function ss(n,t={},e,s){const r={};return s||_(()=>r.children=nt(n,t.children,r.children)),_(()=>t.ref&&t.ref(n)),_(()=>is(n,t,e,!0,r,!0)),r}function rs(n,t){const e=n[t];return Object.defineProperty(n,t,{get(){return e()},enumerable:!0}),n}function os(n,t,e,s){if(e!==void 0&&!s&&(s=[]),typeof t!="function")return nt(n,t,s,e);_(r=>nt(n,t(),r,e),s)}function is(n,t,e,s,r={},o=!1){t||(t={});for(const a in r)if(!(a in t)){if(a==="children")continue;r[a]=ve(n,a,null,r[a],e,o)}for(const a in t){if(a==="children"){s||nt(n,t.children);continue}const i=t[a];r[a]=ve(n,a,i,r[a],e,o)}}function as(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function we(n,t,e){const s=t.trim().split(/\s+/);for(let r=0,o=s.length;r<o;r++)n.classList.toggle(s[r],e)}function ve(n,t,e,s,r,o){let a,i,p,m,f;if(t==="style")return Ke(n,e,s);if(t==="classList")return He(n,e,s);if(e===s)return s;if(t==="ref")o||e(n);else if(t.slice(0,3)==="on:"){const d=t.slice(3);s&&n.removeEventListener(d,s),e&&n.addEventListener(d,e)}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);s&&n.removeEventListener(d,s,!0),e&&n.addEventListener(d,e,!0)}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),v=Ve.has(d);if(!v&&s){const u=Array.isArray(s)?s[0]:s;n.removeEventListener(d,u)}(v||e)&&(Fe(n,d,e,v),v&&qe([d]))}else if(t.slice(0,5)==="attr:")Ot(n,t.slice(5),e);else if((f=t.slice(0,5)==="prop:")||(p=Ye.has(t))||!r&&((m=Ue(t,n.tagName))||(i=ze.has(t)))||(a=n.nodeName.includes("-")))f&&(t=t.slice(5),i=!0),t==="class"||t==="className"?ns(n,e):a&&!i&&!p?n[as(t)]=e:n[m||t]=e;else{const d=r&&t.indexOf(":")>-1&&We[t.split(":")[0]];d?Ge(n,d,t,e):Ot(n,Ie[t]||t,e)}return e}function ls(n){const t=`$$${n.type}`;let e=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==e&&Object.defineProperty(n,"target",{configurable:!0,value:e}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return e||document}});e;){const s=e[t];if(s&&!e.disabled){const r=e[`${t}Data`];if(r!==void 0?s.call(e,r,n):s.call(e,n),n.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function nt(n,t,e,s,r){for(;typeof e=="function";)e=e();if(t===e)return e;const o=typeof t,a=s!==void 0;if(n=a&&e[0]&&e[0].parentNode||n,o==="string"||o==="number")if(o==="number"&&(t=t.toString()),a){let i=e[0];i&&i.nodeType===3?i.data=t:i=document.createTextNode(t),e=J(n,e,s,i)}else e!==""&&typeof e=="string"?e=n.firstChild.data=t:e=n.textContent=t;else if(t==null||o==="boolean")e=J(n,e,s);else{if(o==="function")return _(()=>{let i=t();for(;typeof i=="function";)i=i();e=nt(n,i,e,s)}),()=>e;if(Array.isArray(t)){const i=[],p=e&&Array.isArray(e);if(Kt(i,t,e,r))return _(()=>e=nt(n,i,e,s,!0)),()=>e;if(i.length===0){if(e=J(n,e,s),a)return e}else p?e.length===0?xe(n,i,s):es(n,e,i):(e&&J(n),xe(n,i));e=i}else if(t.nodeType){if(Array.isArray(e)){if(a)return e=J(n,e,s,t);J(n,e,null,t)}else e==null||e===""||!n.firstChild?n.appendChild(t):n.replaceChild(t,n.firstChild);e=t}}return e}function Kt(n,t,e,s){let r=!1;for(let o=0,a=t.length;o<a;o++){let i=t[o],p=e&&e[o],m;if(!(i==null||i===!0||i===!1))if((m=typeof i)=="object"&&i.nodeType)n.push(i);else if(Array.isArray(i))r=Kt(n,i,p)||r;else if(m==="function")if(s){for(;typeof i=="function";)i=i();r=Kt(n,Array.isArray(i)?i:[i],Array.isArray(p)?p:[p])||r}else n.push(i),r=!0;else{const f=String(i);p&&p.nodeType===3&&p.data===f?n.push(p):n.push(document.createTextNode(f))}}return r}function xe(n,t,e=null){for(let s=0,r=t.length;s<r;s++)n.insertBefore(t[s],e)}function J(n,t,e,s){if(e===void 0)return n.textContent="";const r=s||document.createTextNode("");if(t.length){let o=!1;for(let a=t.length-1;a>=0;a--){const i=t[a];if(r!==i){const p=i.parentNode===n;!o&&!a?p?n.replaceChild(r,i):n.insertBefore(r,e):p&&i.remove()}else o=!0}}else n.insertBefore(r,e);return[r]}const cs=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,us=/(?:\s(?<boolean>[^/\s><=]+?)(?=[\s/>]))|(?:(?<name>\S+?)(?:\s*=\s*(?:(['"])(?<quotedValue>[\s\S]*?)\3|(?<unquotedValue>[^\s>]+))))/g,hs={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function ps(n){const t={type:"tag",name:"",voidElement:!1,attrs:[],children:[]},e=n.match(/<\/?([^\s]+?)[/\s>]/);if(e&&(t.name=e[1],(hs[e[1].toLowerCase()]||n.charAt(n.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){const r=n.indexOf("-->");return{type:"comment",comment:r!==-1?n.slice(4,r):""}}const s=new RegExp(us);for(const r of n.matchAll(s))(r[1]||r[2]).startsWith("use:")?t.attrs.push({type:"directive",name:r[1]||r[2],value:r[4]||r[5]||""}):t.attrs.push({type:"attr",name:r[1]||r[2],value:r[4]||r[5]||""});return t}function be(n,t,e){const s=t.indexOf("<",e),r=t.slice(e,s===-1?void 0:s);/^\s*$/.test(r)||n.push({type:"text",content:r})}function $e(n,t){const e=t.replace("<!--","").replace("-->","");/^\s*$/.test(e)||n.push({type:"comment",content:e})}function fs(n){const t=[];let e,s=-1;const r=[],o={};return n.replace(cs,(a,i)=>{const p=a.charAt(1)!=="/",m=a.slice(0,4)==="<!--",f=i+a.length,d=n.charAt(f);let v;p&&!m&&(s++,e=ps(a),!e.voidElement&&d&&d!=="<"&&be(e.children,n,f),o[e.tagName]=e,s===0&&t.push(e),v=r[s-1],v&&v.children.push(e),r[s]=e),m&&(s<0?$e(t,a):$e(r[s].children,a)),(m||!p||e.voidElement)&&(m||s--,d!=="<"&&d&&(v=s===-1?t:r[s].children,be(v,n,f)))}),t}function ds(n){const t=[];for(const e of n)t.push(e.name+'="'+e.value.replace(/"/g,"&quot;")+'"');return t.length?" "+t.join(" "):""}function _e(n,t){switch(t.type){case"text":return n+t.content;case"tag":return n+="<"+t.name+(t.attrs?ds(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?n:n+t.children.reduce(_e,"")+"</"+t.name+">";case"comment":return n+="<!--"+t.content+"-->"}}function ms(n){return n.reduce(function(t,e){return t+_e("",e)},"")}const ke=new Map,ys=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Tt=" \\f\\n\\r\\t",Ze="[^"+Tt+`\\/>"'=]+`,ee="[ "+Tt+"]+(?:use:<!--#-->|"+Ze+")",Je="<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:",Qe=`(?:\\s*=\\s*(?:'[^']*?'|"[^"]*?"|\\([^)]*?\\)|<[^>]*?>|`+Ze+"))?)",gs=new RegExp(Je+ee+Qe+"+)([ "+Tt+"]*/?>)","g"),ws=new RegExp("("+ee+`\\s*=\\s*)(<!--#-->|['"(]([\\w\\s]*<!--#-->[\\w\\s]*)*['")])`,"gi"),vs=new RegExp(Je+ee+Qe+"*)([ "+Tt+"]*/>)","g"),Se="<!--#-->",xs=new Set(["class","on","oncapture","style","use","prop","attr"]);function bs(n,t,e,s){return"<"+t+e.replace(ws,$s)+s}function $s(n,t,e){return t.replace(/<!--#-->/g,"###")+(e[0]==='"'||e[0]==="'"?e.replace(/<!--#-->/g,"###"):'"###"')}function ks(n,t,e){return ys.test(t)?n:"<"+t+e+"></"+t+">"}function Ss(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function qt(n,t,e,s){if(n==="use:###"&&t==="###"){const r=s.counter++;s.exprs.push(`typeof exprs[${r}] === "function" ? r.use(exprs[${r}], ${e}, exprs[${s.counter++}]) : (()=>{throw new Error("use:### must be a function")})()`)}else throw new Error(`Not support syntax ${n} must be use:{function}`)}function As(n,{delegateEvents:t=!0,functionBuilder:e=(...s)=>new Function(...s)}={}){let s=1;n.wrapProps=u=>{const l=Object.getOwnPropertyDescriptors(u);for(const c in l)typeof l[c].value=="function"&&!l[c].value.length&&n.dynamicProperty(u,c);return u};function r(u,l){var c;let w=0,g="";for(;w<u.length-1;w++)g=g+u[w]+"<!--#-->";g=g+u[w],g=[[vs,ks],[/<(<!--#-->)/g,"<###"],[/\.\.\.(<!--#-->)/g,"###"],[gs,bs],[/>\n+\s*/g,">"],[/\n+\s*</g,"<"],[/\s+</g," <"],[/>\s+/g,"> "]].reduce((k,S)=>k.replace(S[0],S[1]),g);const $=fs(g),[y,b]=d($,l.funcBuilder),x=[];for(let k=0;k<y.length;k++){x.push(document.createElement("template")),x[k].innerHTML=y[k];const S=x[k].content.querySelectorAll("script,style");for(let L=0;L<S.length;L++){const A=((c=S[L].firstChild)==null?void 0:c.data)||"";if(A.indexOf(Se)>-1){const C=A.split(Se).reduce((O,T,rt)=>(rt&&O.push(""),O.push(T),O),[]);S[k].firstChild.replaceWith(...C)}}}return x[0].create=b,ke.set(u,x),x}function o(u,l,c,w,g,$,y){let b=w==="###"?`!doNotWrap ? exprs[${y.counter}]() : exprs[${y.counter++}]`:w.split("###").map((A,C)=>C?` + (typeof exprs[${y.counter}] === "function" ? exprs[${y.counter}]() : exprs[${y.counter++}]) + "${A}"`:`"${A}"`).join(""),x,k;(x=c.split(":"))&&x[1]&&xs.has(x[0])&&(c=x[1],k=x[0]);const S=n.ChildProperties.has(c),L=n.Properties.has(c);if(c==="style"){const A=`_$v${s++}`;y.decl.push(`${A}={}`),y.exprs.push(`r.style(${l},${b},${A})`)}else if(c==="classList"){const A=`_$v${s++}`;y.decl.push(`${A}={}`),y.exprs.push(`r.classList(${l},${b},${A})`)}else if(k!=="attr"&&(S||!g&&(n.getPropAlias(c,u.name.toUpperCase())||L)||$||k==="prop"))$&&!S&&!L&&k!=="prop"&&(c=Ss(c)),y.exprs.push(`${l}.${n.getPropAlias(c,u.name.toUpperCase())||c} = ${b}`);else{const A=g&&c.indexOf(":")>-1&&n.SVGNamespace[c.split(":")[0]];A?y.exprs.push(`r.setAttributeNS(${l},"${A}","${c}",${b})`):y.exprs.push(`r.setAttribute(${l},"${n.Aliases[c]||c}",${b})`)}}function a(u,l,c,w,g,$,y){if(c.slice(0,2)==="on")if(c.includes(":")){let b=c.startsWith("oncapture:");y.exprs.push(`${l}.addEventListener("${c.slice(b?10:3)}",exprs[${y.counter++}]${b?",true":""})`)}else{const b=c.slice(2).toLowerCase(),x=t&&n.DelegatedEvents.has(b);y.exprs.push(`r.addEventListener(${l},"${b}",exprs[${y.counter++}],${x})`),x&&y.delegatedEvents.add(b)}else if(c==="ref")y.exprs.push(`exprs[${y.counter++}](${l})`);else{const b=Object.assign({},y,{exprs:[]}),x=y.counter;if(o(u,l,c,w,g,$,b),y.decl.push(`_fn${x} = (${w==="###"?"doNotWrap":""}) => {
${b.exprs.join(`;
`)};
}`),w==="###")y.exprs.push(`typeof exprs[${x}] === "function" ? r.effect(_fn${x}) : _fn${x}(true)`);else{let k="";for(let S=x;S<b.counter;S++)S!==x&&(k+=" || "),k+=`typeof exprs[${S}] === "function"`;y.exprs.push(k+` ? r.effect(_fn${x}) : _fn${x}()`)}y.counter=b.counter,y.wrap=!1}}function i(u,l){const c=Object.assign({},l,{first:!0,multi:!1,parent:l.path});if(u.children.length>1)for(let g=0;g<u.children.length;g++){const $=u.children[g];if($.type==="comment"&&$.content==="#"||$.type==="tag"&&$.name==="###"){c.multi=!0;break}}let w=0;for(;w<u.children.length;){const g=u.children[w];if(g.name==="###"){c.multi?(u.children[w]={type:"comment",content:"#"},w++):u.children.splice(w,1),m(g,c);continue}f(g,c),!c.multi&&g.type==="comment"&&g.content==="#"?u.children.splice(w,1):w++}l.counter=c.counter,l.templateId=c.templateId,l.hasCustomElement=l.hasCustomElement||c.hasCustomElement}function p(u){let l=[];for(const c of u)if(Array.isArray(c)){if(!c.length)continue;l.push(`r.wrapProps({${c.join(",")||""}})`)}else l.push(c);return l.length>1?`r.mergeProps(${l.join(",")})`:l[0]}function m(u,l){let c=[];const w=Object.keys(u.attrs),g=[c],$=l.counter++;for(let b=0;b<w.length;b++){const{type:x,name:k,value:S}=u.attrs[b];if(x==="attr")k==="###"?(g.push(`exprs[${l.counter++}]`),g.push(c=[])):S==="###"?c.push(`${k}: exprs[${l.counter++}]`):c.push(`${k}: "${S}"`);else if(x==="directive"){const L=`_$el${s++}`,A=!l.decl.length;l.decl.push(A?"":`${L} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),qt(k,S,L,l)}}if(u.children.length===1&&u.children[0].type==="comment"&&u.children[0].content==="#")c.push(`children: () => exprs[${l.counter++}]`);else if(u.children.length){const b={type:"fragment",children:u.children},x=Object.assign({},l,{first:!0,decl:[],exprs:[],parent:!1});f(b,x),c.push(`children: () => { ${x.exprs.join(`;
`)}}`),l.templateId=x.templateId,l.counter=x.counter}let y;l.multi&&(y=`_$el${s++}`,l.decl.push(`${y} = ${l.path}.${l.first?"firstChild":"nextSibling"}`)),l.parent?l.exprs.push(`r.insert(${l.parent}, r.createComponent(exprs[${$}],${p(g)})${y?`, ${y}`:""})`):l.exprs.push(`${l.fragment?"":"return "}r.createComponent(exprs[${$}],${p(g)})`),l.path=y,l.first=!1}function f(u,l){if(u.type==="fragment"){const c=[];u.children.forEach(w=>{if(w.type==="tag"){if(w.name==="###"){const y=Object.assign({},l,{first:!0,fragment:!0,decl:[],exprs:[]});m(w,y),c.push(y.exprs[0]),l.counter=y.counter,l.templateId=y.templateId;return}l.templateId++;const g=s,$=Object.assign({},l,{first:!0,decl:[],exprs:[]});l.templateNodes.push([w]),f(w,$),c.push(`function() { ${$.decl.join(`,
`)+`;
`+$.exprs.join(`;
`)+`;
return _$el${g};
`}}()`),l.counter=$.counter,l.templateId=$.templateId}else if(w.type==="text")c.push(`"${w.content}"`);else if(w.type==="comment"){if(w.content==="#")c.push(`exprs[${l.counter++}]`);else if(w.content)for(let g=0;g<w.content.split("###").length-1;g++)c.push(`exprs[${l.counter++}]`)}}),l.exprs.push(`return [${c.join(`, 
`)}]`)}else if(u.type==="tag"){const c=`_$el${s++}`,w=!l.decl.length,g=l.templateId;l.decl.push(w?"":`${c} = ${l.path}.${l.first?"firstChild":"nextSibling"}`);const $=n.SVGElements.has(u.name),y=u.name.includes("-");if(l.hasCustomElement=y,u.attrs.some(b=>b.name==="###")){const b=[];let x="";const k=[];for(let S=0;S<u.attrs.length;S++){const{type:L,name:A,value:C}=u.attrs[S];if(L==="attr")if(C.includes("###")){let O=l.counter++;x+=`${A}: ${A!=="ref"?`typeof exprs[${O}] === "function" ? exprs[${O}]() : `:""}exprs[${O}],`}else A==="###"?(x.length&&(b.push(`()=>({${x}})`),x=""),b.push(`exprs[${l.counter++}]`)):k.push(u.attrs[S]);else L==="directive"&&qt(A,C,c,l)}u.attrs=k,x.length&&b.push(`()=>({${x}})`),l.exprs.push(`r.spread(${c},${b.length===1?`typeof ${b[0]} === "function" ? r.mergeProps(${b[0]}) : ${b[0]}`:`r.mergeProps(${b.join(",")})`},${$},${!!u.children.length})`)}else for(let b=0;b<u.attrs.length;b++){const{type:x,name:k,value:S}=u.attrs[b];x==="directive"?(qt(k,S,c,l),u.attrs.splice(b,1),b--):x==="attr"&&S.includes("###")&&(u.attrs.splice(b,1),b--,a(u,c,k,S,$,y,l))}l.path=c,l.first=!1,i(u,l),w&&(l.decl[0]=l.hasCustomElement?`const ${c} = r.untrack(() => document.importNode(tmpls[${g}].content.firstChild, true))`:`const ${c} = tmpls[${g}].content.firstChild.cloneNode(true)`)}else if(u.type==="text"){const c=`_$el${s++}`;l.decl.push(`${c} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),l.path=c,l.first=!1}else if(u.type==="comment"){const c=`_$el${s++}`;l.decl.push(`${c} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),u.content==="#"&&(l.multi?l.exprs.push(`r.insert(${l.parent}, exprs[${l.counter++}], ${c})`):l.exprs.push(`r.insert(${l.parent}, exprs[${l.counter++}])`)),l.path=c,l.first=!1}}function d(u,l){const c={path:"",decl:[],exprs:[],delegatedEvents:new Set,counter:0,first:!0,multi:!1,templateId:0,templateNodes:[]},w=s,g=u;let $;return u.length>1&&(u=[{type:"fragment",children:u}]),u[0].name==="###"?($=!0,m(u[0],c)):f(u[0],c),n.delegateEvents(Array.from(c.delegatedEvents)),[[g].concat(c.templateNodes).map(y=>ms(y)),l("tmpls","exprs","r",c.decl.join(`,
`)+`;
`+c.exprs.join(`;
`)+($?"":`;
return _$el${w};
`))]}function v(u,...l){const c=ke.get(u)||r(u,{funcBuilder:e});return c[0].create(c,l,n)}return v}const tn=As({effect:_,style:Ke,insert:os,untrack:U,spread:ss,createComponent:bn,delegateEvents:qe,classList:He,mergeProps:Sn,dynamicProperty:rs,setAttribute:Ot,setAttributeNS:Ge,addEventListener:Fe,Aliases:Ie,getPropAlias:Ue,Properties:ze,ChildProperties:Ye,DelegatedEvents:Ve,SVGElements:ts,SVGNamespace:We}),en=(n,t)=>{const e=t.scalingFactor??3,s=tn`<canvas />`;if(t.classes)for(const i of t.classes)s.classList.add(`plotscape-${i}`);t.inner&&(s.style.marginLeft=n.store.marginLeft()+"px",s.style.marginTop=n.store.marginTop()+"px"),n.container.appendChild(s);const r=s.getContext("2d"),o=t.inner?n.store.innerWidth:n.store.width,a=t.inner?n.store.innerHeight:n.store.height;return At(()=>{const[i,p]=[o(),a()];s.style.width=i+"px",s.style.height=p+"px",s.width=Math.ceil(i*e),s.height=Math.ceil(p*e),r.scale(e,e)}),r},Ae={x:{textBaseline:"top",textAlign:"center"},y:{textBaseline:"middle",textAlign:"right"}};class Ce{constructor(t,e){h(this,"at"),h(this,"labels"),h(this,"along"),h(this,"tol"),h(this,"context"),h(this,"scales"),h(this,"store"),h(this,"setValues",(s,r)=>{this.at=s,this.labels=r}),h(this,"draw",()=>{var s,r;const{context:o,scales:a,along:i,store:p}=this,m=a[i],f=((s=this.at)==null?void 0:s.call(this))??m.breaks();let d=((r=this.labels)==null?void 0:r.call(this))??m.breaks();const{height:v,innerBottom:u,innerTop:l,innerLeft:c,innerRight:w}=p,{fontsize:g}=B,$=v()-u()+B.axisOffset,y=c()-B.axisOffset;G(o),o.textBaseline=Ae[i].textBaseline,o.textAlign=Ae[i].textAlign;let b=0;if(i==="x")for(let x=0;x<f.length;x++){const k=d[x],S=m.pushforward(f[x]),{width:L}=o.measureText(k),A=L/2;S-A<c()||S+A>w()||S-L<b||(ye(o,k,S,$,{fontsize:g}),b=S+L)}else if(i==="y")for(let x=0;x<f.length;x++){const k=f[x].toString(),S=m.pushforward(f[x]),{actualBoundingBoxAscent:L}=o.measureText(k),A=L/2;S-A<u()||S+A>l()||ye(o,k,y,v()-S,{fontsize:g})}}),this.along=e,this.tol=0,this.context=en(t,{classes:["margin"],inner:!1}),this.scales=t.scales.outer.data,this.store=t.store}}const zt=[1,2,3,4,5,6,7,8],Cs=["base","user","over",...zt];class ne{constructor(t){this.getter=t}static of(t){return new ne(t)}value(){return this.getter()}}const Le=n=>new dt(n),M=n=>new ne(n);class D{constructor(t,e){this.lower=t,this.upper=e}static default(){return new D(Le(0),Le(1))}setSignals(t,e){return this.lower=t,this.upper=e,this}range(){return this.upper.value()-this.lower.value()}normalize(t){return(t-this.lower.value())/this.range()}unnormalize(t){return t*this.range()+this.lower.value()}}const Ls=n=>({outerH:D.default().setSignals(M(n.innerLeft),M(n.innerRight)),outerV:D.default().setSignals(M(n.innerBottom),M(n.innerTop)),innerH:D.default().setSignals(j(0),M(n.innerWidth)),innerV:D.default().setSignals(j(0),M(n.innerHeight)),normX:D.default().setSignals(M(n.normXLower),M(n.normXUppper)),normY:D.default().setSignals(M(n.normYLower),M(n.normYUpper))}),Es=()=>{const[n,t]=E(!1),[e,s]=E(0),[r,o]=E(0),[a,i]=E(!1),[p,m]=E(!1),[f,d]=E(0),[v,u]=E(0),[l,c]=E(0),[w,g]=E(0),{marginLines:$,fontsize:y}=B,b=Y($[0]*y),x=Y($[1]*y),k=Y($[2]*y),S=Y($[3]*y),L=()=>l()-x(),A=()=>e()-x()-S(),C=()=>r()-b()-k(),O=x,T=()=>e()-S(),rt=b,Yt=()=>r()-k(),{x:yt,y:ot}=B.defaultNorm,[gt,V]=E(yt.lower),[nn,sn]=E(yt.upper),[rn,on]=E(ot.lower),[an,ln]=E(ot.upper),[cn,un]=E(1),[hn,pn]=E(0);return{active:n,width:e,height:r,rightButtonClicked:a,holding:p,mouseX:f,mouseY:v,clickX:l,clickY:w,innerWidth:A,innerHeight:C,innerLeft:O,innerRight:T,innerTop:Yt,innerBottom:rt,marginBottom:b,marginLeft:x,marginTop:k,marginRight:S,innerClickX:L,normXLower:gt,normXUppper:nn,normYLower:rn,normYUpper:an,labelInterval:cn,labelCycle:hn,setActive:t,setWidth:s,setHeight:o,setRightButtonClicked:i,setHolding:m,setMouseX:d,setMouseY:u,setClickX:c,setClickY:g,setLabelInterval:un,setLabelCycle:pn,setNormXLower:V,setNormXUpper:sn,setNormYLower:on,setNormYUpper:ln}};class K{constructor(t,e,s){h(this,"breakWidth",()=>{const r=this.breaks();return this.pushforward(r[1])-this.pushforward(r[0])}),this.domain=t,this.norm=e,this.codomain=s}static default(){return new K(D.default(),D.default(),D.default())}pushforward(t){const{domain:e,norm:s,codomain:r}=this;return r.unnormalize(s.unnormalize(e.normalize(t)))}pullback(t){const{domain:e,norm:s,codomain:r}=this;return e.unnormalize(s.normalize(r.normalize(t)))}setDomain(t,e){return this.domain.lower=t,this.domain.upper=e,this}setNorm(t,e){return this.norm.lower=t,this.norm.upper=e,this}setCodomain(t,e){return this.codomain.lower=t,this.codomain.upper=e,this}breaks(t=4){const{domain:e,norm:s}=this,[r,o]=[e.unnormalize(s.normalize(0)),e.unnormalize(s.normalize(1))],a=(o-r)/t,i=Math.floor(Math.log10(a)),p=[1,2,4,5,10];let[m,f]=[1/0,0];for(let w=0;w<p.length;w++){const g=(p[w]*10**i-a)**2;g<m&&([m,f]=[g,p[w]])}const d=10**i*f,v=Math.ceil(r/d)*d,u=Math.floor(o/d)*d,l=Math.round((u-v)/d),c=[parseFloat(v.toFixed(4))];for(let w=1;w<l;w++){const g=v+w*d;c.push(parseFloat(g.toFixed(4)))}return c.push(parseFloat(u.toFixed(4))),c}}class se{constructor(t,e,s){h(this,"setNorm",(r,o)=>(this.norm.lower=r,this.norm.upper=o,this)),this.values=t,this.norm=e,this.codomain=s}static default(){return new se(te([]),D.default(),D.default())}pushforward(t){const{values:e,norm:s,codomain:r}=this,o=e.value(),a=(o.indexOf(t)+1)/(o.length+1);return r.unnormalize(s.unnormalize(a))}pullback(t){const{values:e,norm:s,codomain:r}=this,o=e.value(),a=s.normalize(r.normalize(t));return o[Math.round(a*(o.length+1))-1]}setValues(t){return this.values=t,this}setCodomain(t,e){return this.codomain.lower=t,this.codomain.upper=e,this}breaks(){return this.values.value()}breakWidth(){const t=this.breaks();return this.pushforward(t[1])-this.pushforward(t[0])}}class tt{constructor(t,e){this.norm=t,this.codomain=e}static default(){return new tt(D.default(),D.default())}setNorm(t,e){return this.norm.lower=t,this.norm.upper=e,this}setCodomain(t,e){return this.codomain.lower=t,this.codomain.upper=e,this}setDomain(t,e){return new K(new D(t,e),this.norm,this.codomain)}setValues(t){return new se(t,this.norm,this.codomain)}pushforward(){return 0}pullback(){}breaks(){return[]}breakWidth(){return 0}}const Ms=n=>{const{outerH:t,outerV:e,innerH:s,innerV:r,normX:o,normY:a}=n;return{inner:{pct:{x:K.default().setDomain(s.lower,s.upper).setNorm(o.lower,o.upper),y:K.default().setDomain(r.lower,r.upper).setNorm(a.lower,a.upper)},data:{x:tt.default().setCodomain(s.lower,s.upper).setNorm(o.lower,o.upper),y:tt.default().setCodomain(r.lower,r.upper).setNorm(a.lower,a.upper)}},outer:{pct:{x:K.default().setDomain(t.lower,t.upper).setNorm(o.lower,o.upper),y:K.default().setDomain(t.lower,t.upper).setNorm(a.lower,a.upper)},data:{x:tt.default().setCodomain(t.lower,t.upper).setNorm(o.lower,o.upper),y:tt.default().setCodomain(e.lower,e.upper).setNorm(a.lower,a.upper)}}}};class re{constructor(t){h(this,"container"),h(this,"store"),h(this,"expanses"),h(this,"scales"),h(this,"contexts"),h(this,"representations"),h(this,"decorations"),h(this,"keyActions"),h(this,"pushRepresentation",i=>{this.representations.push(i);const p=i.keyActions;if(p)for(const[m,f]of Z(p)){const d=this.keyActions[m];this.keyActions[m]=()=>{d?.(),f()}}At(()=>i.draw())}),h(this,"pushDecoration",i=>{this.decorations.push(i),At(()=>i.draw())}),h(this,"resize",()=>this.onResize()),h(this,"activate",()=>{this.store.setActive(!0),this.container.classList.add("active")}),h(this,"deactivate",()=>{this.store.setActive(!1),this.container.classList.remove("active"),G(this.contexts.user)}),h(this,"onResize",()=>{const{setWidth:i,setHeight:p}=this.store;i(Et(getComputedStyle(this.container).width)),p(Et(getComputedStyle(this.container).height)),this.scene.marker.clearTransient(),this.representations.forEach(m=>m.draw()),this.decorations.forEach(m=>m.draw())}),h(this,"onMouseDown",i=>{const{height:p,marginBottom:m,marginLeft:f,setHolding:d,setClickX:v,setClickY:u,setMouseX:l,setMouseY:c}=this.store;this.scene.plots.forEach(y=>y.deactivate()),this.scene.marker.clearTransient(),this.activate();const w=i.offsetX-f(),g=p()-i.offsetY-m();d(!0),wt(()=>{v(w),u(g),l(w),c(g)});const{setSelected:$}=this.scene.store;i.button===0&&this.representations.forEach(y=>$(y.checkSelection([w,g,w,g])))}),h(this,"onContextMenu",i=>{i.preventDefault(),this.store.setRightButtonClicked(!0)}),h(this,"onMouseUp",()=>{this.store.setRightButtonClicked(!1),this.store.setHolding(!1)}),h(this,"onMouseMove",i=>{const{store:p,contexts:m,scene:f,representations:d}=this;if(!p.holding())return;const{height:v,marginLeft:u,marginBottom:l,setMouseX:c,setMouseY:w}=p,g=i.offsetX-u(),$=v()-i.offsetY-l();if(p.rightButtonClicked()){const{mouseX:T,mouseY:rt,width:Yt,height:yt}=p,ot=(g-T())/Yt(),gt=($-rt())/yt();p.setNormXLower(V=>V+ot),p.setNormXUpper(V=>V+ot),p.setNormYLower(V=>V+gt),p.setNormYUpper(V=>V+gt),wt(()=>{c(g),w($)});return}const{clickX:y,clickY:b,mouseX:x,mouseY:k}=p,[S,L,A,C]=[y,x,b,k].map(An);G(m.user),ct(m.user,S,A,L,C,{alpha:.25}),f.marker.clearTransient(),wt(()=>{c(g),w($)});const{setSelected:O}=f.store;d.forEach(T=>O(T.checkSelection([S,A,L,C])))}),h(this,"onKeyDown",i=>{var p,m;this.store.active()&&((m=(p=this.keyActions)[i.code])==null||m.call(p))}),h(this,"onKeyUp",()=>{this.scene.store.setGroup(lt)}),this.scene=t;const e=tn`<div
      class="plotscape-container"
    ></div>`;this.container=e,t.app.appendChild(e),window.addEventListener("resize",Vt(this.onResize,50)),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mousemove",Vt(this.onMouseMove,30)),window.addEventListener("keydown",Vt(this.onKeyDown,50));const s=Es(),r=Ls(s),o=Ms(r);this.store=s,this.expanses=r,this.scales=o,this.contexts={};for(const i of Cs){const p={inner:i!="over",classes:[`${i}`]};this.contexts[i]=en(this,p)}this.representations=[],this.decorations=[],this.pushDecoration(new Ce(this,"x")),this.pushDecoration(new Ce(this,"y"));const{defaultNorm:a}=B;this.keyActions={KeyR:()=>{this.store.setNormXLower(a.x.lower),this.store.setNormYLower(a.y.lower),this.store.setNormXUpper(a.x.upper),this.store.setNormYUpper(a.y.upper)},KeyZ:()=>{const{store:i,contexts:p,expanses:m}=this,[f,d,v,u]=[i.clickX(),i.clickY(),i.mouseX(),i.mouseY()],{innerH:l,innerV:c,normX:w,normY:g}=m;if(Math.abs(v-f)<10||Math.abs(u-d)<10)return;const[$,y]=[f,v].sort(Mt).map(l.normalize).map(w.normalize),[b,x]=[d,u].sort(Mt).map(c.normalize).map(g.normalize),k=1/(y-$),S=1/(x-b);wt(()=>{i.setNormXLower(-$*k),i.setNormYLower(-b*S),i.setNormXUpper(-$*k+k),i.setNormYUpper(-b*S+S)}),t.marker.clearTransient(),G(p.user)}},t.pushPlot(this)}}const oe={alpha:.5,color:B.transientColour};class Ns{constructor(t){h(this,"widthPct"),h(this,"setWidthPct"),h(this,"keyActions"),h(this,"draw",()=>{const{contexts:r,partData:o,scaleX:a,scaleY:i,breakWidthX:p}=this.adapter,m=this.widthPct(),f=o(2),d=p()*m;for(const v of zt)G(r[v]);for(const v of f){const u=a(v.x.value())-d/2,l=a(v.x.value())+d/2,c=i(v.y0.value()),w=i(v.y1.value()),g=v[Rt].value(),$=v[Dt].value(),y=v[Xt].value(),b=r[$],x=B.groupColours[g-1];ct(b,u,c,l,w,{alpha:1,color:x}),y&&ct(b,u,c,l,w,oe)}}),h(this,"checkSelection",r=>{const{partData:o,scaleX:a,scaleY:i,breakWidthX:p}=this.adapter,m=this.widthPct(),f=o(1),d=p()*m,v=[r[0],r[2]],u=[r[1],r[3]],l=new Set;for(const c of f){const w=a(c.x.value())-d/2,g=a(c.x.value())+d/2,$=i(c.y0.value()),y=i(c.y1.value());if(Jt([w,g],[$,y],v,u))for(const b of c[q].value())l.add(b)}return l}),this.adapter=t;const[e,s]=E(B.width);this.widthPct=e,this.setWidthPct=s,this.keyActions={Equal:()=>this.setWidthPct(r=>Math.min(1,r*10/9)),Minus:()=>this.setWidthPct(r=>r*9/10),KeyR:()=>this.setWidthPct(B.width)}}}class ie{constructor(t,e,s){h(this,"partData",r=>this.partitionSet.partData(r)),h(this,"scaleX",r=>this.scales.inner.data.x.pushforward(r)),h(this,"scaleY",r=>this.scales.inner.data.y.pushforward(r)),h(this,"breakWidthX",()=>this.scales.inner.data.x.breakWidth()),h(this,"breakWidthY",()=>this.scales.inner.data.y.breakWidth()),this.contexts=t,this.partitionSet=e,this.scales=s}}function Os(){return{reduced:!1,mapped:!1,stacked:!1,relabeled:!1}}class ae{constructor(t,e,s,r,o,a,i){this.reducefn=t,this.reduceinit=e,this.mapfn=s,this.stackfn=r,this.stackinit=o,this.relabelfn=a,this.state=i}static default(){return new ae(pe,fe,he,pe,fe,he,Os())}reduce(t,e){return this.reducefn=t,this.reduceinit=e,this.state.reduced=!0,this}map(t){return this.mapfn=t,this.state.mapped=!0,this}stack(t,e){return this.stackfn=t,this.stackinit=e,this.state.stacked=!0,this}relabel(t){return this.relabelfn=t,this.state.relabeled=!0,this}}class le{constructor(t,e=0){h(this,"variable"),h(this,"meta"),this.index=e,this.variable=t.toVariable(),this.meta=this.variable.meta}static from(t){return new le(t)}empty(){}ith(){return this.variable.ith(Y(this.index))}values(){return[this.variable.ith(Y(0))]}push(){return 1}isOfLength(){return!0}}class ce{constructor(t,e,s,r){h(this,"reduced"),h(this,"mappedStacked"),h(this,"update",()=>{this.reduced=it(()=>this.reduce()),this.mappedStacked=it(()=>this.mapAndStack())}),h(this,"nest",(o,a)=>{const{data:i,factor:p}=this;a=a??this.recipe;const m=()=>F.product(p(),o());return new ce(m,i,a,this)}),h(this,"reduce",()=>{const{data:o,parent:a,recipe:i}=this;if(!i.state.reduced){const y={},b=this.factor().data().cols;for(const x of z(b))y[x]=b[x];for(const x of z(o.cols))y[x]=o.cols[x];return P.from(o.n,y)}const p=this.factor(),m=p.indices(),f=a?U(a.factor):void 0,d=f?.indices(),v={},u={},l=at.from(o,0);let c=d?.next();for(const y of m)v[y]||(v[y]=i.reduceinit(),u[y]=c?.value),v[y]=i.reducefn(v[y],l.values()),c=d?.next(),l.slide();const w=I.from(Object.values(u)),g=P.fromRows(Object.values(v)),$=p.data();a&&g.appendCol(de,w);for(const[y,b]of Z($.cols))g.appendCol(y,b);return g}),h(this,"mapAndStack",()=>{const{recipe:o,parent:a}=this,i=this.reduced(),p=U(this.factor);if(!a){const c=o.mapfn(i.row(Y(0))),w=P.fromRows([c]);for(const g of $t)g in i.cols&&w.appendCol(g,i.cols[g]);return w}const m=a?U(a.mapAndStack):void 0,f=m?.rows(),d=at.from(i,0);if(!o.state.stacked){const c={};for(const g of z(d.values()))c[g]=On();let w=!0;try{o.mapfn(c)}catch{w=!1}if(w){const g=o.mapfn(i.cols);for(const y of z(g))Pn(g[y])&&(g[y]=le.from(g[y]));const $=P.from(i.n,g);for(const y of $t)y in i.cols&&$.appendCol(y,i.cols[y]);return $}}const v=o.mapfn(d.values()),u={};for(const c of z(v))u[c]=v[c].toVariable();const l=P.from(1,u).empty();for(const c of p.uniqueIndices()){const w=d.values();if(!f){l.push(o.mapfn(w)),d.slide();continue}const g=w[de].value(),$=f[g];w.parent=$;const y=o.mapfn(w);if(!o.state.stacked){l.push(y),d.slide();continue}$[xt]||($[xt]=o.stackinit());const b=o.stackfn($[xt],y);f[g][xt]=b,l.push(Object.assign(y,b)),d.slide()}for(const c of $t)c in i.cols&&l.appendCol(c,i.cols[c]);return l}),this.factor=t,this.data=e,this.recipe=s,this.parent=r,this.reduced=it(()=>this.reduce()),this.mappedStacked=it(()=>this.mapAndStack())}}class ue{constructor(t,e){h(this,"partitions"),h(this,"recipes"),h(this,"reduceAt",(s,r,o)=>(this.recipes[s].reduce(r,o),this)),h(this,"apply",s=>s(this)),h(this,"reduce",(s,r)=>{for(const o of this.recipes)o.reduce(s,r);return this}),h(this,"mapAt",(s,r)=>(this.recipes[s].map(r),this)),h(this,"map",s=>{for(const r of this.recipes)r.map(s);return this}),h(this,"stackAt",(s,r,o)=>(this.recipes[s].stack(r,o),this)),h(this,"stack",(s,r)=>{for(const o of this.recipes)o.stack(s,r);return this}),h(this,"relabelAt",(s,r)=>(this.recipes[s].relabel(r),this)),h(this,"relabel",s=>{for(const r of this.recipes)r.relabel(s);return this}),h(this,"partData",s=>this.partitions[s].mappedStacked()),h(this,"update",()=>{const{factors:s,data:r,recipes:o}=this;let a=new ce(s[0],r,o[0]);this.partitions.push(a);for(let i=1;i<this.factors.length;i++)a=a.nest(s[i],o[i]),this.partitions.push(a);for(const i of this.partitions)i.update();return this}),this.factors=t,this.data=e,this.partitions=[],this.recipes=[];for(const s of t)this.recipes.push(ae.default())}}const Ps=n=>n.map(({var1:t,var2:e})=>({x:t,y:e})).update(),js=n=>n.reduce(({count:t},{})=>({count:t.inc()}),()=>({count:j(0)})).map(({label:t,count:e})=>({x:t,y0:j(0),y1:e})).stackAt(2,(t,e)=>({y0:t.y1,y1:t.y1.add(e.y1)}),()=>({y0:j(0),y1:j(0)})).update(),Ds=n=>n.reduce(({count:t},e)=>({count:t.inc()}),()=>({count:j(0)})).map(({binMin:t,binMax:e,count:s})=>({x0:t,x1:e,y0:j(0),y1:s})).stackAt(2,(t,e)=>({y0:t.y1,y1:t.y1.add(e.y1)}),()=>({y0:j(0),y1:j(0)})).update();class Ee{constructor(t,e){h(this,"data"),h(this,"factors"),h(this,"plot"),h(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new re(t),this.data=t.data.select(e);const{data:s,plot:r}=this,[o,a]=E(void 0),i=()=>F.mono(t.data.n),p=()=>s.cols.var1.factor(o()),m=t.marker.factor;this.factors=[i,p,m],this.partitionSet=new ue(this.factors,s).apply(js);const f=()=>this.partitionSet.partData(1);for(const g of Be(r.scales))g.data.x=g.data.x.setValues(M(()=>f().cols.x.values())),g.data.y=g.data.y.setDomain(j(0),M(()=>f().cols.y1.meta.max));this.plot.store.setNormYLower=Xe;const d=()=>f().cols.y1.values(),v=()=>s.cols.var1.meta.values,u=()=>Ln(v(),d());let l=!0;Object.assign(this.plot.keyActions,{KeyO:()=>{l?(a(u()),l=!1):(a(v()),l=!0)}});const c=new ie(r.contexts,this.partitionSet,r.scales),w=new Ns(c);r.pushRepresentation(w)}}class Rs{constructor(t){h(this,"draw",()=>{const{contexts:e,partData:s,scaleX:r,scaleY:o}=this.adapter,a=s(2);for(const i of zt)G(e[i]);for(const i of a){const p=r(i.x0.value()),m=r(i.x1.value()),f=o(i.y0.value()),d=o(i.y1.value()),v=i[Rt].value(),u=i[Dt].value(),l=i[Xt].value(),c=e[u],w=B.groupColours[v-1];ct(c,p,f,m,d,{alpha:1,color:w}),l&&ct(c,p,f,m,d,oe)}}),h(this,"checkSelection",e=>{const{partData:s,scaleX:r,scaleY:o}=this.adapter,a=s(1),i=[e[0],e[2]],p=[e[1],e[3]],m=new Set;for(const f of a){const d=r(f.x0.value()),v=r(f.x1.value()),u=o(f.y0.value()),l=o(f.y1.value());if(Jt([d,v],[u,l],i,p))for(const c of f[q].value())m.add(c)}return m}),this.adapter=t}}class Xs{constructor(t,e){h(this,"plot"),h(this,"data"),h(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new re(t),this.data=t.data.select(e);const{data:s,plot:r}=this,{keyActions:o}=r,{min:a,max:i}=s.cols.var1.meta,p=i-a,[m,f]=E(p/20),[d,v]=E(a);o.Equal=()=>f(b=>b*10/9),o.Minus=()=>f(b=>b*9/10),o.BracketRight=()=>v(b=>b+1),o.BracketLeft=()=>v(b=>b-1);const u=()=>F.mono(s.n),l=()=>s.cols.var1.bin(M(m),M(d)),c=t.marker.factor,w=[u,l,c];this.partitionSet=new ue(w,s).apply(Ds);const g=()=>this.partitionSet.partData(1);for(const b of Object.values(r.scales))b.data.x=b.data.x.setDomain(M(()=>g().cols.x0.meta.min),M(()=>g().cols.x1.meta.max)),b.data.y=b.data.y.setDomain(j(0),M(()=>g().cols.y1.meta.max));this.plot.store.setNormYLower=Xe;const $=new ie(r.contexts,this.partitionSet,r.scales),y=new Rs($);r.pushRepresentation(y)}}class Bs{constructor(t){h(this,"radiusMult"),h(this,"setRadiusMult"),h(this,"keyActions"),h(this,"draw",()=>{const{contexts:r,partData:o,scaleX:a,scaleY:i}=this.adapter,p=this.radiusMult(),{radius:m}=B,f=o(2),d=m*p;for(const u of zt)G(r[u]);const{height:v}=r.base.canvas.getBoundingClientRect();for(const u of f){const l=a(u.x.value()),c=i(u.y.value()),w=u[Rt].value(),g=u[Dt].value(),$=u[Xt].value(),y=r[g],b=B.groupColours[w-1];me(y,l,v-c,{radius:d,color:b}),$&&me(y,l,v-c,{...oe,radius:d})}}),h(this,"checkSelection",r=>{const{partData:o,scaleX:a,scaleY:i}=this.adapter,p=this.radiusMult(),m=o(1),f=[r[0],r[2]],d=[r[1],r[3]],v=new Set;for(const u of m){const l=a(u.x.value()),c=i(u.y.value()),w=[l-p,l+p],g=[c-p,c+p];if(Jt(w,g,f,d))for(const $ of u[q].value())v.add($)}return v}),this.adapter=t;const[e,s]=E(1);this.radiusMult=e,this.setRadiusMult=s,this.keyActions={Equal:()=>this.setRadiusMult(r=>r*10/9),Minus:()=>this.setRadiusMult(r=>r*9/10),KeyR:()=>this.setRadiusMult(1)}}}class Ts{constructor(t,e){h(this,"data"),h(this,"plot"),h(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new re(t),this.data=t.data.select(e);const{data:s,plot:r}=this,o=()=>F.mono(t.data.n),a=()=>F.iso(t.data.n),i=t.marker.factor,p=[o,a,i];this.partitionSet=new ue(p,s).apply(Ps);const m=()=>this.partitionSet.partData(1);for(const v of Be(r.scales))v.data.x=v.data.x.setDomain(M(()=>m().cols.x.meta.min),M(()=>m().cols.x.meta.max)),v.data.y=v.data.y.setDomain(M(()=>m().cols.y.meta.min),M(()=>m().cols.y.meta.max));const f=new ie(r.contexts,this.partitionSet,r.scales),d=new Bs(f);r.pushRepresentation(d)}}const zs=await Mn("https://raw.githubusercontent.com/bartonicek/plotscape5/master/public/mpg.json"),Ys={cyl:"discrete",manufacturer:"discrete",hwy:"numeric",displ:"numeric"},Is=P.parseCols(zs,Ys),Us=document.querySelector("#app");yn(()=>{const n=new Zn(Us,Is);new Ee(n,t=>({var1:t.cyl})),new Ee(n,t=>({var1:t.manufacturer})),new Xs(n,t=>({var1:t.hwy})),new Ts(n,t=>({var1:t.displ,var2:t.hwy}))});
