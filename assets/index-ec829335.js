(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();var bn=Object.defineProperty,$n=(n,t,e)=>t in n?bn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,d=(n,t,e)=>($n(n,typeof t!="symbol"?t+"":t,e),e);const kn=(n,t)=>n===t,ee=Symbol("solid-proxy"),Ct={equals:kn};let je=qe;const Q=1,Mt=2,Re={owned:null,cleanups:null,context:null,owner:null};var T=null;let Kt=null,E=null,D=null,H=null,Rt=0;function An(n,t){const e=E,s=T,r=n.length===0,i=t===void 0?s:t,a=r?Re:{owned:null,cleanups:null,context:i?i.context:null,owner:i},o=r?n:()=>n(()=>W(()=>Yt(a)));T=a,E=null;try{return at(o,!0)}finally{E=e,T=s}}function z(n,t){t=t?Object.assign({},Ct,t):Ct;const e={value:n,observers:null,observerSlots:null,comparator:t.equals||void 0},s=r=>(typeof r=="function"&&(r=r(e.value)),Be(e,r));return[Ye.bind(e),s]}function _(n,t,e){const s=ue(n,t,!1,Q);ft(s)}function Pt(n,t,e){je=Cn;const s=ue(n,t,!1,Q);(!e||!e.render)&&(s.user=!0),H?H.push(s):ft(s)}function ne(n,t,e){e=e?Object.assign({},Ct,e):Ct;const s=ue(n,t,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=e.equals||void 0,ft(s),Ye.bind(s)}function St(n){return at(n,!1)}function W(n){if(E===null)return n();const t=E;E=null;try{return n()}finally{E=t}}function Ye(){if(this.sources&&this.state)if(this.state===Q)ft(this);else{const n=D;D=null,at(()=>zt(this),!1),D=n}if(E){const n=this.observers?this.observers.length:0;E.sources?(E.sources.push(this),E.sourceSlots.push(n)):(E.sources=[this],E.sourceSlots=[n]),this.observers?(this.observers.push(E),this.observerSlots.push(E.sources.length-1)):(this.observers=[E],this.observerSlots=[E.sources.length-1])}return this.value}function Be(n,t,e){let s=n.value;return(!n.comparator||!n.comparator(s,t))&&(n.value=t,n.observers&&n.observers.length&&at(()=>{for(let r=0;r<n.observers.length;r+=1){const i=n.observers[r],a=Kt&&Kt.running;a&&Kt.disposed.has(i),(a?!i.tState:!i.state)&&(i.pure?D.push(i):H.push(i),i.observers&&Ie(i)),a||(i.state=Q)}if(D.length>1e6)throw D=[],new Error},!1)),t}function ft(n){if(!n.fn)return;Yt(n);const t=T,e=E,s=Rt;E=T=n,Sn(n,n.value,s),E=e,T=t}function Sn(n,t,e){let s;try{s=n.fn(t)}catch(r){return n.pure&&(n.state=Q,n.owned&&n.owned.forEach(Yt),n.owned=null),n.updatedAt=e+1,We(r)}(!n.updatedAt||n.updatedAt<=e)&&(n.updatedAt!=null&&"observers"in n?Be(n,s):n.value=s,n.updatedAt=e)}function ue(n,t,e,s=Q,r){const i={fn:n,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:T,context:T?T.context:null,pure:e};return T===null||T!==Re&&(T.owned?T.owned.push(i):T.owned=[i]),i}function Ot(n){if(n.state===0)return;if(n.state===Mt)return zt(n);if(n.suspense&&W(n.suspense.inFallback))return n.suspense.effects.push(n);const t=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<Rt);)n.state&&t.push(n);for(let e=t.length-1;e>=0;e--)if(n=t[e],n.state===Q)ft(n);else if(n.state===Mt){const s=D;D=null,at(()=>zt(n,t[0]),!1),D=s}}function at(n,t){if(D)return n();let e=!1;t||(D=[]),H?e=!0:H=[],Rt++;try{const s=n();return Ln(e),s}catch(s){e||(H=null),D=null,We(s)}}function Ln(n){if(D&&(qe(D),D=null),n)return;const t=H;H=null,t.length&&at(()=>je(t),!1)}function qe(n){for(let t=0;t<n.length;t++)Ot(n[t])}function Cn(n){let t,e=0;for(t=0;t<n.length;t++){const s=n[t];s.user?n[e++]=s:Ot(s)}for(t=0;t<e;t++)Ot(n[t])}function zt(n,t){n.state=0;for(let e=0;e<n.sources.length;e+=1){const s=n.sources[e];if(s.sources){const r=s.state;r===Q?s!==t&&(!s.updatedAt||s.updatedAt<Rt)&&Ot(s):r===Mt&&zt(s,t)}}}function Ie(n){for(let t=0;t<n.observers.length;t+=1){const e=n.observers[t];e.state||(e.state=Mt,e.pure?D.push(e):H.push(e),e.observers&&Ie(e))}}function Yt(n){let t;if(n.sources)for(;n.sources.length;){const e=n.sources.pop(),s=n.sourceSlots.pop(),r=e.observers;if(r&&r.length){const i=r.pop(),a=e.observerSlots.pop();s<r.length&&(i.sourceSlots[a]=s,r[s]=i,e.observerSlots[s]=a)}}if(n.owned){for(t=n.owned.length-1;t>=0;t--)Yt(n.owned[t]);n.owned=null}if(n.cleanups){for(t=n.cleanups.length-1;t>=0;t--)n.cleanups[t]();n.cleanups=null}n.state=0}function Mn(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function We(n,t=T){throw Mn(n)}function Pn(n,t){return W(()=>n(t||{}))}function $t(){return!0}const On={get(n,t,e){return t===ee?e:n.get(t)},has(n,t){return t===ee?!0:n.has(t)},set:$t,deleteProperty:$t,getOwnPropertyDescriptor(n,t){return{configurable:!0,enumerable:!0,get(){return n.get(t)},set:$t,deleteProperty:$t}},ownKeys(n){return n.keys()}};function Zt(n){return(n=typeof n=="function"?n():n)?n:{}}function zn(){for(let n=0,t=this.length;n<t;++n){const e=this[n]();if(e!==void 0)return e}}function En(...n){let t=!1;for(let i=0;i<n.length;i++){const a=n[i];t=t||!!a&&ee in a,n[i]=typeof a=="function"?(t=!0,ne(a)):a}if(t)return new Proxy({get(i){for(let a=n.length-1;a>=0;a--){const o=Zt(n[a])[i];if(o!==void 0)return o}},has(i){for(let a=n.length-1;a>=0;a--)if(i in Zt(n[a]))return!0;return!1},keys(){const i=[];for(let a=0;a<n.length;a++)i.push(...Object.keys(Zt(n[a])));return[...new Set(i)]}},On);const e={},s={},r=new Set;for(let i=n.length-1;i>=0;i--){const a=n[i];if(!a)continue;const o=Object.getOwnPropertyNames(a);for(let h=0,p=o.length;h<p;h++){const f=o[h];if(f==="__proto__"||f==="constructor")continue;const m=Object.getOwnPropertyDescriptor(a,f);if(!r.has(f))m.get?(r.add(f),Object.defineProperty(e,f,{enumerable:!0,configurable:!0,get:zn.bind(s[f]=[m.get.bind(a)])})):(m.value!==void 0&&r.add(f),e[f]=m.value);else{const v=s[f];v?m.get?v.push(m.get.bind(a)):m.value!==void 0&&v.push(()=>m.value):e[f]===void 0&&(e[f]=m.value)}}}return e}function se(n){return n}function Nn(n){return n()}function Ue(){}function I(n){return()=>n}function re(n,t){return t}function oe(){return{}}function Dn(n,t){return function(){n(),t()}}function Xn(n){return n.toString()}function Et(n){return parseInt(n,10)}function $e(n,t){return n-t}function ie(n,t){return n.localeCompare(t,"en",{numeric:!0})}function he(n,t){const e=Math.abs(t-n)+1,s=t>=n?1:-1;return Array.from(Array(e),(r,i)=>n+s*i)}function Z(n){let[t,e]=[1/0,-1/0];for(let s=0;s<n.length;s++)t=Math.min(t,n[s]),e=Math.max(e,n[s]);return[t,e]}function Tn(n,t){const e=[...n];return e.sort((s,r)=>Math.sign(t[e.indexOf(s)]-t[e.indexOf(r)])),e}function Y(n){return Reflect.ownKeys(n)}function fe(n){const t=[];for(const e of Y(n))t.push(n[e]);return t}function tt(n){const t=[];for(const e of Y(n))t.push([e,n[e]]);return t}function Ve(n){const t={};for(const[e,s]of tt(n))t[e]=s.value();return t}async function jn(n){return await(await fetch(n)).json()}function Qt(n,t){let e=0;return(...s)=>{const r=new Date().getTime();r-e<t||(e=r,n(...s))}}function Bt(n,t){const[e,s]=n,[r,i,a,o]=t;return!(e<r||e>a||s<i||s>o)}function qt(n,t,e,s){const[r,i]=Z(n),[a,o]=Z(t),[h,p]=Z(e),[f,m]=Z(s);return!(i<h||r>p||o<f||a>m)}class ut{constructor(t,e){d(this,"row"),d(this,"indexfn"),this.index=e,this.indexfn=()=>this.index,this.row=t.row(this.indexfn)}static from(t,e){return new ut(t,e)}values(){return this.row}slide(){return this.index++,this}}const Lt=["parent","positions","stack","layer","group","transient"].map(Symbol),[Jt,U,kt,pt,dt,mt]=Lt;class yt{constructor(t){this.valueLike=t}static of(t){return new yt(t)}value(){return this.valueLike.value()}toVariable(){return B.from([this.value()])}}class gt{constructor(t,e){this.array=t,this.indexfn=e}static of(t,e){return new gt(t,e)}value(){return this.array[this.indexfn()]}}const ae=class{constructor(t,e){d(this,"name"),d(this,"meta"),this.array=t,this.name=e?.name}empty(){this.array.length=0}values(){return this.array}ith(t){return yt.of(gt.of(this.array,t))}push(t){return this.array.push(t.value())}isOfLength(t){return this.array.length===t}};d(ae,"from",n=>new ae(n));let B=ae;class It{constructor(t){this.valueLike=t}static of(t){return new It(t)}value(){return this.valueLike.value()}toVariable(){return vt.from([this.value()])}}const Rn={sort:!0};class vt{constructor(t,e){d(this,"array"),d(this,"name"),d(this,"meta"),d(this,"empty",()=>{this.array.length=0,this.meta.values.length=0}),e={...Rn,...e},this.array=t.map(Xn),this.name=e?.name,this.meta={values:Array.from(new Set(this.array))},e.sort&&this.meta.values.sort(ie)}static from(t,e){return new vt(t,e)}values(){return this.array}ith(t){return It.of(gt.of(this.array,t))}push(t){const e=t.value();return this.array.push(e),this.meta.values.indexOf(e)===-1&&(this.meta.values.push(e),this.meta.values.sort(ie)),this.array.length}isOfLength(t){return this.array.length===t}factor(t){return V.from(this,t)}}class Nt{constructor(t,e){d(this,"name"),d(this,"meta"),this.variable=t,this.translatefn=e,this.name=this.variable.name,this.meta=this.variable.meta}static from(t,e){return new Nt(t,e)}empty(){this.variable.empty()}ith(t){return this.variable.ith(this.translatefn(t))}values(){return this.variable.values()}push(t){return this.variable.push(t)}isOfLength(t){return this.variable.isOfLength(t)}}class At{constructor(t,e,s){this._uniqueIndices=t,this._indices=e,this._data=s}cardinality(){return this._uniqueIndices.size}*uniqueIndices(){yield*this._uniqueIndices}*indices(){yield*this._indices}data(){return this._data}}class xt{constructor(t){this.val=t}static of(t){return new xt(t)}value(){return this.val}}class pe{constructor(){}static of(){return new pe}value(){}toVariable(){return B.from([])}}class wt{constructor(t){this.valueLike=t}static of(t){return new wt(t)}value(){return this.valueLike.value()}toVariable(){return rt.from([this.value()])}inc(){return P(this.value()+1)}dec(){return P(this.value()-1)}add(t){return P(this.value()+t.value())}minus(t){return P(this.value()-t.value())}times(t){return P(this.value()*t.value())}divideBy(t){return P(this.value()/t.value())}}const P=n=>wt.of(xt.of(n)),de=n=>yt.of(xt.of(n)),Yn=()=>pe.of(),Bn=n=>n instanceof wt||n instanceof It||n instanceof yt;class qn{constructor(t){this.n=t}cardinality(){return this.n}*uniqueIndices(){let t=0;for(;t<this.n;)yield t++}*indices(){yield*this.uniqueIndices()}data(){const t=I(this.n),e=()=>{},s=a=>a===this.n,r=a=>{if(a()<this.n)return de(new Set([a()]))},i={ith:r,push:t,values:()=>{const a=Array(this.n);for(let o=0;o<this.n;o++)a[o]=r(I(o));return a},empty:e,isOfLength:s};return new N(this.n,{[U]:i})}}class In{constructor(t){this.n=t}cardinality(){return 1}*uniqueIndices(){yield 0}*indices(){let t=0;for(;t<this.n;)yield 0,t++}data(){const t=I(1),e=()=>{},s=a=>a===this.n,r=a=>{if(a()===0)return de(new Set(he(0,this.n)))},i={ith:r,push:t,values:()=>{const a=Array(this.n);for(let o=0;o<this.n;o++)a[o]=r(I(o));return a},empty:e,isOfLength:s};return new N(1,{[U]:i})}}class V{static mono(t){return new In(t)}static iso(t){return new qn(t)}static computed(t,e,s){return new At(t,e,s)}static from(t,e){const{array:s,meta:r}=t;e||(e=r.values.sort(ie));const i=new Set(he(0,e.length)),a=[],o={};for(let p=0;p<s.length;p++){const f=e.indexOf(s[p].toString());o[f]||(o[f]=new Set),o[f].add(p),a.push(f)}const h=new N(e.length,{label:vt.from(e,{name:t.name}),[U]:B.from(Object.values(o))});return new At(i,a,h)}static bin(t,e,s){const r=t.values(),[i,a]=Z(r),o=e?Math.ceil((a-i)/e)+1:10;e=e??(a-i)/(o-1),s=s??i;const h=i-e+(s-i)%e,p=a+e-(a-s)%e,f=Array(o+2);f[0]=h,f[f.length-1]=p;for(let $=1;$<f.length-1;$++)f[$]=h+$*e;const m=new Set,v=[],c={};for(let $=0;$<r.length;$++){const A=f.findIndex(S=>S>=r[$])-1;c[A]||(c[A]=new Set),c[A].add($),m.add(A),v.push(A)}const l=Array.from(m).sort($e),u=new Set,y={};for(const[$,A]of Object.entries(l)){const S=Et($);u.add(S),y[A]=S}const x=v;for(let $=0;$<x.length;$++)x[$]=y[x[$]];const k=[],g=[];for(const $ of l)k.push(f[$]),g.push(f[$+1]);const b={bin0:rt.from(k,{name:t.name}),bin1:rt.from(g,{name:t.name}),[U]:B.from(Object.values(c))},w=new N(u.size,b);return new At(u,x,w)}static product(t,e){const s=e.cardinality(),r=new Set,i=[],a={},o={},h={},p=t.indices(),f=e.indices();let m=p.next(),v=f.next(),c=0;for(;!m.done;){const L=m.value*s+v.value;a[L]||(a[L]=new Set),a[L].add(c),r.add(L),i.push(L),o[L]=m.value,h[L]=v.value,m=p.next(),v=f.next(),c++}const l=Array.from(r).sort($e),u=new Set,y={},x={},k={};for(const[L,R]of Object.entries(l)){const q=Et(L);u.add(q),y[R]=q,x[q]=o[R],k[q]=h[R]}const g=i;for(let L=0;L<g.length;L++)g[L]=y[g[L]];const b=t.data(),w=e.data(),$={},A=L=>()=>x[L()],S=L=>()=>k[L()],C=new Set;for(const[L,R]of tt(b.cols))typeof L=="string"&&C.add(L),$[L]=new Nt(R,A);for(let[L,R]of tt(w.cols)){if(typeof L=="string")for(;C.has(L);)L+="$";$[L]=new Nt(R,S)}$[U]=B.from(Object.values(a));const j=new N(u.size,$);return new At(u,g,j)}}class rt{constructor(t,e){d(this,"name"),d(this,"meta"),this.array=t;const[s,r]=Z(t);this.name=e?.name,this.meta={min:s,max:r}}static from(t,e){return new rt(t,e)}empty(){this.array.length=0,this.meta.min=1/0,this.meta.max=-1/0}values(){return this.array}ith(t){return wt.of(gt.of(this.array,t))}push(t){const e=t.value();return this.array.push(e),this.meta.min=Math.min(this.meta.min,e),this.meta.max=Math.max(this.meta.max,e),this.array.length}isOfLength(t){return this.array.length===t}bin(t,e){return V.bin(this,t.value(),e.value())}}class N{constructor(t,e){d(this,"keys"),this.n=t,this.cols=e,this.keys=new Set(Y(e))}static from(t,e){return new N(t,e)}static fromRows(t){const e={};for(const r of Y(t[0]))t[0][r]&&(e[r]=t[0][r].toVariable());const s=new N(1,e);for(let r=1;r<t.length;r++)s.push(t[r]);return s}static parseCols(t,e){const s={},r={numeric:rt,discrete:vt,reference:B};for(const[i,a]of tt(e))s[i]=new r[a](t[i],{name:i});return N.from(Object.values(t)[0].length,s)}empty(){for(const t of Y(this.cols))this.cols[t].empty();return this.n=0,this}row(t){const e={};for(const s of this.keys)e[s]=this.cols[s].ith(t);return e}rows(){const t=[];for(let e=0;e<this.n;e++)t.push(this.row(()=>e));return t}push(t){for(const e of Y(this.cols))this.cols[e].push(t[e]);return this.n++}unwrapRow(t){return Ve(this.row(t))}unwrapRows(){const t=[];for(let e=0;e<this.n;e++)t.push(this.unwrapRow(()=>e));return t}select(t){const e=t(this.cols);return N.from(this.n,e)}appendCol(t,e){const s=this.cols;return s[t]=e,this.keys.add(t),N.from(this.n,s)}appendCols(t){if(t.n!=this.n)throw new Error("Dataframes have different number of rows.");const e=this.cols;for(const[s,r]of tt(t.cols))e[s]=r;return new N(this.n,e)}*[Symbol.iterator](){const t=ut.from(this,0);yield t.values();for(let e=1;e<this.n;e++)yield t.slide().values()}}const ht=0,[_t,Wn,Un,Vn]=[7,6,5,4],Fn=n=>n&-5,Gn=n=>n|4,Hn=[0,1,2,3],Kn=B.from([4,3,2,1,4,3,2,1]),Zn=B.from([1,2,3,4,5,6,7,8]),Qn=B.from(Array.from(Array(8),(n,t)=>t<4)),Jn=new Set(he(0,7));class _n{constructor(t,e,s){d(this,"data"),d(this,"transientPositions"),d(this,"positionsArray"),d(this,"indices"),d(this,"setIndices"),d(this,"factor"),d(this,"update",()=>{const{positionsArray:p,transientPositions:f}=this,[m,v]=[this.selectedS(),W(this.groupS)],c=[...W(this.indices)];if(m.size){for(const l of p)for(const u of m)l.delete(u);if(v===ht){f.clear();for(const l of m){const u=Fn(c[l]);c[l]=u,p[u].add(l),f.add(l)}}else for(const l of m)c[l]=v,p[v].add(l);this.setIndices(c)}}),this.n=t,this.groupS=e,this.selectedS=s;const r=Array.from(Array(8),()=>new Set),i=B.from(r);this.positionsArray=r,this.data=N.from(t,{[U]:i,[dt]:Kn,[pt]:Zn,[mt]:Qn}),this.transientPositions=new Set;const a=Array(t).fill(_t),[o,h]=z(a);this.indices=o,this.setIndices=h,this.factor=()=>V.computed(Jn,o(),this.data),Pt(this.update)}hasTransient(){return this.transientPositions.size>0}clearAll(){const{n:t,positionsArray:e}=this;for(const s of e)s.clear();for(let s=0;s<t;s++)e[_t].add(s);this.setIndices(Array(t).fill(_t))}clearTransient(){const{n:t,positionsArray:e,transientPositions:s}=this,r=[...W(this.indices)];for(const i of Hn)e[i].clear();for(let i=0;i<t;i++)r[i]=Gn(r[i]);s.clear(),this.setIndices(r)}}const X={axisOffset:5,radius:3,width:.8,alpha:1,colour:"#4682B4",groupColours:["#D1D5DE","#E41A1C","#4DAF4A","#984EA3"],transientColour:"#377EB8",labelFontsize:16,titleFontsize:20,marginLines:[4,4,2,2],defaultNorm:{x:{lower:.05,upper:.95},y:{lower:.05,upper:.95}}},Fe={color:"black",stroke:void 0,alpha:1};function F(n){const{width:t,height:e}=n.canvas.getBoundingClientRect();n.clearRect(0,0,t,e)}const ts=Fe;function et(n,t,e,s,r,i){const[a,o]=[s-t,r-e],{height:h}=n.canvas.getBoundingClientRect(),p=Object.assign({},ts,i);n.save(),n.fillStyle=p.color,n.globalAlpha=p.alpha,n.fillRect(t,h-e,a,-o),i!=null&&i.stroke&&(n.strokeStyle=i.stroke,n.strokeRect(t,h-e,a,-o)),n.restore()}const es={...Fe,radius:X.radius};function ke(n,t,e,s){const r=Object.assign({},es,s);n.save(),n.fillStyle=r.color,n.globalAlpha=r.alpha,n.beginPath(),n.arc(t,e,r.radius,0,2*Math.PI,!1),n.fill(),r.stroke&&(n.strokeStyle=r.stroke,n.stroke()),n.restore()}function Dt(n,t,e,s,r){n.save(),n.translate(e,s),r!=null&&r.vertical&&n.rotate(-Math.PI/2),n.font=`${r?.fontsize??"10"}px ${r?.fontfamily??"Arial"}`,n.fillText(t,0,0),n.translate(-e,-s),n.restore()}const Ge=`
- Click/click and drag to select objects
- Hold 1/2/3 to make a permanent selection
- Right click and drag to pan
- Press O to order by count (barplot) 
- Press Q with selection to query
- Press Z to zoom into current selection
- Press +/- to change object size/width
- Press [/] to change histogram anchor
`,ns=()=>{const[n,t]=z(ht),[e,s]=z(new Set);return{group:n,selected:e,setGroup:t,setSelected:s}};console.log(Ge);const ss=n=>n.classList.contains("plotscape-scene");class rs{constructor(t,e){d(this,"container"),d(this,"nPlots"),d(this,"nCols"),d(this,"nRows"),d(this,"plots"),d(this,"marker"),d(this,"store"),d(this,"keyActions"),d(this,"setRowsCols",(a,o)=>{document.documentElement.style.setProperty("--ncols",o.toString()),document.documentElement.style.setProperty("--nrows",a.toString());for(const h of this.plots)h.resize()}),d(this,"pushPlot",a=>{this.plots.push(a),this.nPlots++,this.nCols=Math.ceil(Math.sqrt(this.nPlots)),this.nRows=Math.ceil(this.nPlots/this.nCols),this.setRowsCols(this.nRows,this.nCols)}),d(this,"deactivateAll",()=>{for(const a of this.plots)a.deactivate()}),d(this,"onMouseDown",a=>{for(const h of this.plots)F(h.contexts.user);const{target:o}=a;o instanceof Element&&ss(o)&&this.deactivateAll()}),d(this,"onDoubleClick",()=>{this.deactivateAll(),this.marker.clearAll(),this.store.setGroup(ht),this.store.setSelected(new Set)}),d(this,"onKeyDown",a=>{var o,h;const p=a.code;(h=(o=this.keyActions)[p])==null||h.call(o)}),d(this,"onKeyUp",()=>{this.store.setGroup(ht)}),this.app=t,this.data=e,this.container=document.createElement("div"),this.container.classList.add("plotscape-scene");const s=document.createElement("button");this.app.appendChild(s),this.app.appendChild(this.container),this.nPlots=0,this.nCols=0,this.nRows=0;const r=ns();this.store=r,this.marker=new _n(e.n,r.group,r.selected),this.plots=[],this.keyActions={Digit1:()=>this.store.setGroup(Wn),Digit2:()=>this.store.setGroup(Un),Digit3:()=>this.store.setGroup(Vn)},this.app.addEventListener("mousedown",this.onMouseDown),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("dblclick",this.onDoubleClick);const i=document.createElement("dialog");s.classList.add("plotscape-help-button"),i.classList.add("plotscape-help-modal"),i.innerText=Ge,s.innerText="?",s.onclick=()=>i.showModal(),i.onclick=()=>i.close(),this.app.appendChild(i)}}function ot(n){return n.charAt(0).toUpperCase()+n.slice(1)}const os=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],He=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...os]),Ke=new Set(["innerHTML","textContent","innerText","children"]),Ze=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),is=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function Qe(n,t){const e=is[n];return typeof e=="object"?e[t]?e.$:void 0:e}const Je=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),as=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),_e={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function ls(n,t,e){let s=e.length,r=t.length,i=s,a=0,o=0,h=t[r-1].nextSibling,p=null;for(;a<r||o<i;){if(t[a]===e[o]){a++,o++;continue}for(;t[r-1]===e[i-1];)r--,i--;if(r===a){const f=i<s?o?e[o-1].nextSibling:e[i-o]:h;for(;o<i;)n.insertBefore(e[o++],f)}else if(i===o)for(;a<r;)(!p||!p.has(t[a]))&&t[a].remove(),a++;else if(t[a]===e[i-1]&&e[o]===t[r-1]){const f=t[--r].nextSibling;n.insertBefore(e[o++],t[a++].nextSibling),n.insertBefore(e[--i],f),t[r]=e[i]}else{if(!p){p=new Map;let m=o;for(;m<i;)p.set(e[m],m++)}const f=p.get(t[a]);if(f!=null)if(o<f&&f<i){let m=a,v=1,c;for(;++m<r&&m<i&&!((c=p.get(t[m]))==null||c!==f+v);)v++;if(v>f-o){const l=t[a];for(;o<f;)n.insertBefore(e[o++],l)}else n.replaceChild(e[o++],t[a++])}else a++;else t[a++].remove()}}}const Ae="_$DX_DELEGATE";function tn(n,t=window.document){const e=t[Ae]||(t[Ae]=new Set);for(let s=0,r=n.length;s<r;s++){const i=n[s];e.has(i)||(e.add(i),t.addEventListener(i,ms))}}function Xt(n,t,e){e==null?n.removeAttribute(t):n.setAttribute(t,e)}function en(n,t,e,s){s==null?n.removeAttributeNS(t,e):n.setAttributeNS(t,e,s)}function cs(n,t){t==null?n.removeAttribute("class"):n.className=t}function nn(n,t,e,s){if(s)Array.isArray(e)?(n[`$$${t}`]=e[0],n[`$$${t}Data`]=e[1]):n[`$$${t}`]=e;else if(Array.isArray(e)){const r=e[0];n.addEventListener(t,e[0]=i=>r.call(n,e[1],i))}else n.addEventListener(t,e)}function sn(n,t,e={}){const s=Object.keys(t||{}),r=Object.keys(e);let i,a;for(i=0,a=r.length;i<a;i++){const o=r[i];!o||o==="undefined"||t[o]||(Se(n,o,!1),delete e[o])}for(i=0,a=s.length;i<a;i++){const o=s[i],h=!!t[o];!o||o==="undefined"||e[o]===h||!h||(Se(n,o,!0),e[o]=h)}return e}function rn(n,t,e){if(!t)return e?Xt(n,"style"):t;const s=n.style;if(typeof t=="string")return s.cssText=t;typeof e=="string"&&(s.cssText=e=void 0),e||(e={}),t||(t={});let r,i;for(i in e)t[i]==null&&s.removeProperty(i),delete e[i];for(i in t)r=t[i],r!==e[i]&&(s.setProperty(i,r),e[i]=r);return e}function us(n,t={},e,s){const r={};return s||_(()=>r.children=it(n,t.children,r.children)),_(()=>t.ref&&t.ref(n)),_(()=>ps(n,t,e,!0,r,!0)),r}function hs(n,t){const e=n[t];return Object.defineProperty(n,t,{get(){return e()},enumerable:!0}),n}function fs(n,t,e,s){if(e!==void 0&&!s&&(s=[]),typeof t!="function")return it(n,t,s,e);_(r=>it(n,t(),r,e),s)}function ps(n,t,e,s,r={},i=!1){t||(t={});for(const a in r)if(!(a in t)){if(a==="children")continue;r[a]=Le(n,a,null,r[a],e,i)}for(const a in t){if(a==="children"){s||it(n,t.children);continue}const o=t[a];r[a]=Le(n,a,o,r[a],e,i)}}function ds(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function Se(n,t,e){const s=t.trim().split(/\s+/);for(let r=0,i=s.length;r<i;r++)n.classList.toggle(s[r],e)}function Le(n,t,e,s,r,i){let a,o,h,p,f;if(t==="style")return rn(n,e,s);if(t==="classList")return sn(n,e,s);if(e===s)return s;if(t==="ref")i||e(n);else if(t.slice(0,3)==="on:"){const m=t.slice(3);s&&n.removeEventListener(m,s),e&&n.addEventListener(m,e)}else if(t.slice(0,10)==="oncapture:"){const m=t.slice(10);s&&n.removeEventListener(m,s,!0),e&&n.addEventListener(m,e,!0)}else if(t.slice(0,2)==="on"){const m=t.slice(2).toLowerCase(),v=Je.has(m);if(!v&&s){const c=Array.isArray(s)?s[0]:s;n.removeEventListener(m,c)}(v||e)&&(nn(n,m,e,v),v&&tn([m]))}else if(t.slice(0,5)==="attr:")Xt(n,t.slice(5),e);else if((f=t.slice(0,5)==="prop:")||(h=Ke.has(t))||!r&&((p=Qe(t,n.tagName))||(o=He.has(t)))||(a=n.nodeName.includes("-")))f&&(t=t.slice(5),o=!0),t==="class"||t==="className"?cs(n,e):a&&!o&&!h?n[ds(t)]=e:n[p||t]=e;else{const m=r&&t.indexOf(":")>-1&&_e[t.split(":")[0]];m?en(n,m,t,e):Xt(n,Ze[t]||t,e)}return e}function ms(n){const t=`$$${n.type}`;let e=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==e&&Object.defineProperty(n,"target",{configurable:!0,value:e}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return e||document}});e;){const s=e[t];if(s&&!e.disabled){const r=e[`${t}Data`];if(r!==void 0?s.call(e,r,n):s.call(e,n),n.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function it(n,t,e,s,r){for(;typeof e=="function";)e=e();if(t===e)return e;const i=typeof t,a=s!==void 0;if(n=a&&e[0]&&e[0].parentNode||n,i==="string"||i==="number")if(i==="number"&&(t=t.toString()),a){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=st(n,e,s,o)}else e!==""&&typeof e=="string"?e=n.firstChild.data=t:e=n.textContent=t;else if(t==null||i==="boolean")e=st(n,e,s);else{if(i==="function")return _(()=>{let o=t();for(;typeof o=="function";)o=o();e=it(n,o,e,s)}),()=>e;if(Array.isArray(t)){const o=[],h=e&&Array.isArray(e);if(le(o,t,e,r))return _(()=>e=it(n,o,e,s,!0)),()=>e;if(o.length===0){if(e=st(n,e,s),a)return e}else h?e.length===0?Ce(n,o,s):ls(n,e,o):(e&&st(n),Ce(n,o));e=o}else if(t.nodeType){if(Array.isArray(e)){if(a)return e=st(n,e,s,t);st(n,e,null,t)}else e==null||e===""||!n.firstChild?n.appendChild(t):n.replaceChild(t,n.firstChild);e=t}}return e}function le(n,t,e,s){let r=!1;for(let i=0,a=t.length;i<a;i++){let o=t[i],h=e&&e[i],p;if(!(o==null||o===!0||o===!1))if((p=typeof o)=="object"&&o.nodeType)n.push(o);else if(Array.isArray(o))r=le(n,o,h)||r;else if(p==="function")if(s){for(;typeof o=="function";)o=o();r=le(n,Array.isArray(o)?o:[o],Array.isArray(h)?h:[h])||r}else n.push(o),r=!0;else{const f=String(o);h&&h.nodeType===3&&h.data===f?n.push(h):n.push(document.createTextNode(f))}}return r}function Ce(n,t,e=null){for(let s=0,r=t.length;s<r;s++)n.insertBefore(t[s],e)}function st(n,t,e,s){if(e===void 0)return n.textContent="";const r=s||document.createTextNode("");if(t.length){let i=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(r!==o){const h=o.parentNode===n;!i&&!a?h?n.replaceChild(r,o):n.insertBefore(r,e):h&&o.remove()}else i=!0}}else n.insertBefore(r,e);return[r]}const ys=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,gs=/(?:\s(?<boolean>[^/\s><=]+?)(?=[\s/>]))|(?:(?<name>\S+?)(?:\s*=\s*(?:(['"])(?<quotedValue>[\s\S]*?)\3|(?<unquotedValue>[^\s>]+))))/g,vs={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function xs(n){const t={type:"tag",name:"",voidElement:!1,attrs:[],children:[]},e=n.match(/<\/?([^\s]+?)[/\s>]/);if(e&&(t.name=e[1],(vs[e[1].toLowerCase()]||n.charAt(n.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){const r=n.indexOf("-->");return{type:"comment",comment:r!==-1?n.slice(4,r):""}}const s=new RegExp(gs);for(const r of n.matchAll(s))(r[1]||r[2]).startsWith("use:")?t.attrs.push({type:"directive",name:r[1]||r[2],value:r[4]||r[5]||""}):t.attrs.push({type:"attr",name:r[1]||r[2],value:r[4]||r[5]||""});return t}function Me(n,t,e){const s=t.indexOf("<",e),r=t.slice(e,s===-1?void 0:s);/^\s*$/.test(r)||n.push({type:"text",content:r})}function Pe(n,t){const e=t.replace("<!--","").replace("-->","");/^\s*$/.test(e)||n.push({type:"comment",content:e})}function ws(n){const t=[];let e,s=-1;const r=[],i={};return n.replace(ys,(a,o)=>{const h=a.charAt(1)!=="/",p=a.slice(0,4)==="<!--",f=o+a.length,m=n.charAt(f);let v;h&&!p&&(s++,e=xs(a),!e.voidElement&&m&&m!=="<"&&Me(e.children,n,f),i[e.tagName]=e,s===0&&t.push(e),v=r[s-1],v&&v.children.push(e),r[s]=e),p&&(s<0?Pe(t,a):Pe(r[s].children,a)),(p||!h||e.voidElement)&&(p||s--,m!=="<"&&m&&(v=s===-1?t:r[s].children,Me(v,n,f)))}),t}function bs(n){const t=[];for(const e of n)t.push(e.name+'="'+e.value.replace(/"/g,"&quot;")+'"');return t.length?" "+t.join(" "):""}function on(n,t){switch(t.type){case"text":return n+t.content;case"tag":return n+="<"+t.name+(t.attrs?bs(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?n:n+t.children.reduce(on,"")+"</"+t.name+">";case"comment":return n+="<!--"+t.content+"-->"}}function $s(n){return n.reduce(function(t,e){return t+on("",e)},"")}const Oe=new Map,ks=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Wt=" \\f\\n\\r\\t",an="[^"+Wt+`\\/>"'=]+`,me="[ "+Wt+"]+(?:use:<!--#-->|"+an+")",ln="<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:",cn=`(?:\\s*=\\s*(?:'[^']*?'|"[^"]*?"|\\([^)]*?\\)|<[^>]*?>|`+an+"))?)",As=new RegExp(ln+me+cn+"+)([ "+Wt+"]*/?>)","g"),Ss=new RegExp("("+me+`\\s*=\\s*)(<!--#-->|['"(]([\\w\\s]*<!--#-->[\\w\\s]*)*['")])`,"gi"),Ls=new RegExp(ln+me+cn+"*)([ "+Wt+"]*/>)","g"),ze="<!--#-->",Cs=new Set(["class","on","oncapture","style","use","prop","attr"]);function Ms(n,t,e,s){return"<"+t+e.replace(Ss,Ps)+s}function Ps(n,t,e){return t.replace(/<!--#-->/g,"###")+(e[0]==='"'||e[0]==="'"?e.replace(/<!--#-->/g,"###"):'"###"')}function Os(n,t,e){return ks.test(t)?n:"<"+t+e+"></"+t+">"}function zs(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function te(n,t,e,s){if(n==="use:###"&&t==="###"){const r=s.counter++;s.exprs.push(`typeof exprs[${r}] === "function" ? r.use(exprs[${r}], ${e}, exprs[${s.counter++}]) : (()=>{throw new Error("use:### must be a function")})()`)}else throw new Error(`Not support syntax ${n} must be use:{function}`)}function Es(n,{delegateEvents:t=!0,functionBuilder:e=(...s)=>new Function(...s)}={}){let s=1;n.wrapProps=c=>{const l=Object.getOwnPropertyDescriptors(c);for(const u in l)typeof l[u].value=="function"&&!l[u].value.length&&n.dynamicProperty(c,u);return c};function r(c,l){var u;let y=0,x="";for(;y<c.length-1;y++)x=x+c[y]+"<!--#-->";x=x+c[y],x=[[Ls,Os],[/<(<!--#-->)/g,"<###"],[/\.\.\.(<!--#-->)/g,"###"],[As,Ms],[/>\n+\s*/g,">"],[/\n+\s*</g,"<"],[/\s+</g," <"],[/>\s+/g,"> "]].reduce(($,A)=>$.replace(A[0],A[1]),x);const k=ws(x),[g,b]=m(k,l.funcBuilder),w=[];for(let $=0;$<g.length;$++){w.push(document.createElement("template")),w[$].innerHTML=g[$];const A=w[$].content.querySelectorAll("script,style");for(let S=0;S<A.length;S++){const C=((u=A[S].firstChild)==null?void 0:u.data)||"";if(C.indexOf(ze)>-1){const j=C.split(ze).reduce((L,R,q)=>(q&&L.push(""),L.push(R),L),[]);A[$].firstChild.replaceWith(...j)}}}return w[0].create=b,Oe.set(c,w),w}function i(c,l,u,y,x,k,g){let b=y==="###"?`!doNotWrap ? exprs[${g.counter}]() : exprs[${g.counter++}]`:y.split("###").map((C,j)=>j?` + (typeof exprs[${g.counter}] === "function" ? exprs[${g.counter}]() : exprs[${g.counter++}]) + "${C}"`:`"${C}"`).join(""),w,$;(w=u.split(":"))&&w[1]&&Cs.has(w[0])&&(u=w[1],$=w[0]);const A=n.ChildProperties.has(u),S=n.Properties.has(u);if(u==="style"){const C=`_$v${s++}`;g.decl.push(`${C}={}`),g.exprs.push(`r.style(${l},${b},${C})`)}else if(u==="classList"){const C=`_$v${s++}`;g.decl.push(`${C}={}`),g.exprs.push(`r.classList(${l},${b},${C})`)}else if($!=="attr"&&(A||!x&&(n.getPropAlias(u,c.name.toUpperCase())||S)||k||$==="prop"))k&&!A&&!S&&$!=="prop"&&(u=zs(u)),g.exprs.push(`${l}.${n.getPropAlias(u,c.name.toUpperCase())||u} = ${b}`);else{const C=x&&u.indexOf(":")>-1&&n.SVGNamespace[u.split(":")[0]];C?g.exprs.push(`r.setAttributeNS(${l},"${C}","${u}",${b})`):g.exprs.push(`r.setAttribute(${l},"${n.Aliases[u]||u}",${b})`)}}function a(c,l,u,y,x,k,g){if(u.slice(0,2)==="on")if(u.includes(":")){let b=u.startsWith("oncapture:");g.exprs.push(`${l}.addEventListener("${u.slice(b?10:3)}",exprs[${g.counter++}]${b?",true":""})`)}else{const b=u.slice(2).toLowerCase(),w=t&&n.DelegatedEvents.has(b);g.exprs.push(`r.addEventListener(${l},"${b}",exprs[${g.counter++}],${w})`),w&&g.delegatedEvents.add(b)}else if(u==="ref")g.exprs.push(`exprs[${g.counter++}](${l})`);else{const b=Object.assign({},g,{exprs:[]}),w=g.counter;if(i(c,l,u,y,x,k,b),g.decl.push(`_fn${w} = (${y==="###"?"doNotWrap":""}) => {
${b.exprs.join(`;
`)};
}`),y==="###")g.exprs.push(`typeof exprs[${w}] === "function" ? r.effect(_fn${w}) : _fn${w}(true)`);else{let $="";for(let A=w;A<b.counter;A++)A!==w&&($+=" || "),$+=`typeof exprs[${A}] === "function"`;g.exprs.push($+` ? r.effect(_fn${w}) : _fn${w}()`)}g.counter=b.counter,g.wrap=!1}}function o(c,l){const u=Object.assign({},l,{first:!0,multi:!1,parent:l.path});if(c.children.length>1)for(let x=0;x<c.children.length;x++){const k=c.children[x];if(k.type==="comment"&&k.content==="#"||k.type==="tag"&&k.name==="###"){u.multi=!0;break}}let y=0;for(;y<c.children.length;){const x=c.children[y];if(x.name==="###"){u.multi?(c.children[y]={type:"comment",content:"#"},y++):c.children.splice(y,1),p(x,u);continue}f(x,u),!u.multi&&x.type==="comment"&&x.content==="#"?c.children.splice(y,1):y++}l.counter=u.counter,l.templateId=u.templateId,l.hasCustomElement=l.hasCustomElement||u.hasCustomElement}function h(c){let l=[];for(const u of c)if(Array.isArray(u)){if(!u.length)continue;l.push(`r.wrapProps({${u.join(",")||""}})`)}else l.push(u);return l.length>1?`r.mergeProps(${l.join(",")})`:l[0]}function p(c,l){let u=[];const y=Object.keys(c.attrs),x=[u],k=l.counter++;for(let b=0;b<y.length;b++){const{type:w,name:$,value:A}=c.attrs[b];if(w==="attr")$==="###"?(x.push(`exprs[${l.counter++}]`),x.push(u=[])):A==="###"?u.push(`${$}: exprs[${l.counter++}]`):u.push(`${$}: "${A}"`);else if(w==="directive"){const S=`_$el${s++}`,C=!l.decl.length;l.decl.push(C?"":`${S} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),te($,A,S,l)}}if(c.children.length===1&&c.children[0].type==="comment"&&c.children[0].content==="#")u.push(`children: () => exprs[${l.counter++}]`);else if(c.children.length){const b={type:"fragment",children:c.children},w=Object.assign({},l,{first:!0,decl:[],exprs:[],parent:!1});f(b,w),u.push(`children: () => { ${w.exprs.join(`;
`)}}`),l.templateId=w.templateId,l.counter=w.counter}let g;l.multi&&(g=`_$el${s++}`,l.decl.push(`${g} = ${l.path}.${l.first?"firstChild":"nextSibling"}`)),l.parent?l.exprs.push(`r.insert(${l.parent}, r.createComponent(exprs[${k}],${h(x)})${g?`, ${g}`:""})`):l.exprs.push(`${l.fragment?"":"return "}r.createComponent(exprs[${k}],${h(x)})`),l.path=g,l.first=!1}function f(c,l){if(c.type==="fragment"){const u=[];c.children.forEach(y=>{if(y.type==="tag"){if(y.name==="###"){const g=Object.assign({},l,{first:!0,fragment:!0,decl:[],exprs:[]});p(y,g),u.push(g.exprs[0]),l.counter=g.counter,l.templateId=g.templateId;return}l.templateId++;const x=s,k=Object.assign({},l,{first:!0,decl:[],exprs:[]});l.templateNodes.push([y]),f(y,k),u.push(`function() { ${k.decl.join(`,
`)+`;
`+k.exprs.join(`;
`)+`;
return _$el${x};
`}}()`),l.counter=k.counter,l.templateId=k.templateId}else if(y.type==="text")u.push(`"${y.content}"`);else if(y.type==="comment"){if(y.content==="#")u.push(`exprs[${l.counter++}]`);else if(y.content)for(let x=0;x<y.content.split("###").length-1;x++)u.push(`exprs[${l.counter++}]`)}}),l.exprs.push(`return [${u.join(`, 
`)}]`)}else if(c.type==="tag"){const u=`_$el${s++}`,y=!l.decl.length,x=l.templateId;l.decl.push(y?"":`${u} = ${l.path}.${l.first?"firstChild":"nextSibling"}`);const k=n.SVGElements.has(c.name),g=c.name.includes("-");if(l.hasCustomElement=g,c.attrs.some(b=>b.name==="###")){const b=[];let w="";const $=[];for(let A=0;A<c.attrs.length;A++){const{type:S,name:C,value:j}=c.attrs[A];if(S==="attr")if(j.includes("###")){let L=l.counter++;w+=`${C}: ${C!=="ref"?`typeof exprs[${L}] === "function" ? exprs[${L}]() : `:""}exprs[${L}],`}else C==="###"?(w.length&&(b.push(`()=>({${w}})`),w=""),b.push(`exprs[${l.counter++}]`)):$.push(c.attrs[A]);else S==="directive"&&te(C,j,u,l)}c.attrs=$,w.length&&b.push(`()=>({${w}})`),l.exprs.push(`r.spread(${u},${b.length===1?`typeof ${b[0]} === "function" ? r.mergeProps(${b[0]}) : ${b[0]}`:`r.mergeProps(${b.join(",")})`},${k},${!!c.children.length})`)}else for(let b=0;b<c.attrs.length;b++){const{type:w,name:$,value:A}=c.attrs[b];w==="directive"?(te($,A,u,l),c.attrs.splice(b,1),b--):w==="attr"&&A.includes("###")&&(c.attrs.splice(b,1),b--,a(c,u,$,A,k,g,l))}l.path=u,l.first=!1,o(c,l),y&&(l.decl[0]=l.hasCustomElement?`const ${u} = r.untrack(() => document.importNode(tmpls[${x}].content.firstChild, true))`:`const ${u} = tmpls[${x}].content.firstChild.cloneNode(true)`)}else if(c.type==="text"){const u=`_$el${s++}`;l.decl.push(`${u} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),l.path=u,l.first=!1}else if(c.type==="comment"){const u=`_$el${s++}`;l.decl.push(`${u} = ${l.path}.${l.first?"firstChild":"nextSibling"}`),c.content==="#"&&(l.multi?l.exprs.push(`r.insert(${l.parent}, exprs[${l.counter++}], ${u})`):l.exprs.push(`r.insert(${l.parent}, exprs[${l.counter++}])`)),l.path=u,l.first=!1}}function m(c,l){const u={path:"",decl:[],exprs:[],delegatedEvents:new Set,counter:0,first:!0,multi:!1,templateId:0,templateNodes:[]},y=s,x=c;let k;return c.length>1&&(c=[{type:"fragment",children:c}]),c[0].name==="###"?(k=!0,p(c[0],u)):f(c[0],u),n.delegateEvents(Array.from(u.delegatedEvents)),[[x].concat(u.templateNodes).map(g=>$s(g)),l("tmpls","exprs","r",u.decl.join(`,
`)+`;
`+u.exprs.join(`;
`)+(k?"":`;
return _$el${y};
`))]}function v(c,...l){const u=Oe.get(c)||r(c,{funcBuilder:e});return u[0].create(u,l,n)}return v}const ce=Es({effect:_,style:rn,insert:fs,untrack:W,spread:us,createComponent:Pn,delegateEvents:tn,classList:sn,mergeProps:En,dynamicProperty:hs,setAttribute:Xt,setAttributeNS:en,addEventListener:nn,Aliases:Ze,getPropAlias:Qe,Properties:He,ChildProperties:Ke,DelegatedEvents:Je,SVGElements:as,SVGNamespace:_e}),ye=(n,t)=>{const e=t.scalingFactor??3,s=ce`<canvas />`;if(t.classes)for(const o of t.classes)s.classList.add(`plotscape-${o}`);t.inner&&(s.style.marginLeft=n.store.marginLeft()+"px",s.style.marginTop=n.store.marginTop()+"px"),n.container.appendChild(s);const r=s.getContext("2d"),i=t.inner?n.store.innerWidth:n.store.width,a=t.inner?n.store.innerHeight:n.store.height;return Pt(()=>{const[o,h]=[i(),a()];s.style.width=o+"px",s.style.height=h+"px",s.width=Math.ceil(o*e),s.height=Math.ceil(h*e),r.scale(e,e)}),r},Ee={x:{textBaseline:"top",textAlign:"center"},y:{textBaseline:"middle",textAlign:"right"}};class Ne{constructor(t,e){d(this,"at"),d(this,"labels"),d(this,"along"),d(this,"tol"),d(this,"context"),d(this,"scales"),d(this,"store"),d(this,"setValues",(s,r)=>{this.at=s,this.labels=r}),d(this,"draw",()=>{var s,r;const{context:i,scales:a,along:o,store:h}=this,p=a[o],f=((s=this.at)==null?void 0:s.call(this))??p.breaks();let m=((r=this.labels)==null?void 0:r.call(this))??p.breaks();const{height:v,innerBottom:c,innerTop:l,innerLeft:u,innerRight:y}=h,{labelFontsize:x}=X,k=v()-c()+X.axisOffset,g=u()-X.axisOffset;F(i),i.textBaseline=Ee[o].textBaseline,i.textAlign=Ee[o].textAlign;let b=0;if(o==="x")for(let w=0;w<f.length;w++){const $=m[w],A=p.pushforward(f[w]),{width:S}=i.measureText($),C=S/2;A-C<u()||A+C>y()||A-S<b||(Dt(i,$,A,k,{fontsize:x}),b=A+S)}else if(o==="y")for(let w=0;w<f.length;w++){const $=f[w].toString(),A=p.pushforward(f[w]),{actualBoundingBoxAscent:S}=i.measureText($),C=S/2;A-C<c()||A+C>l()||Dt(i,$,g,v()-A,{fontsize:x})}}),this.along=e,this.tol=0,this.context=ye(t,{classes:["margin"],inner:!1}),this.scales=t.scales.outer.data,this.store=t.store}}const De={x:{textBaseline:"top",textAlign:"center"},y:{textBaseline:"bottom",textAlign:"left"}};class Xe{constructor(t,e){d(this,"context"),d(this,"scales"),d(this,"store"),d(this,"draw",()=>{const{context:s,scales:r,along:i,store:a}=this,o=this.title();if(!o)return;const h=r.pct[i],{height:p,marginLeft:f,marginBottom:m}=a,{titleFontsize:v}=X,c=p()-m()/2,l=f()/2,u=h.pushforward(.5);F(s),s.textBaseline=De[i].textBaseline,s.textAlign=De[i].textAlign;const y={fontsize:v,fontfamily:"Times"};i==="x"?Dt(s,o,u,c,y):Dt(s,o,l,u,{...y,vertical:!0})}),this.plot=t,this.along=e,this.context=ye(t,{inner:!1,classes:["over"]}),this.scales=t.scales.outer,this.store=t.store}title(){return this.plot[`${this.along}Title`]}}const bt=[1,2,3,4,5,6,7,8],Ns=["base","user","over",...bt];class ge{constructor(t){this.getter=t}static of(t){return new ge(t)}value(){return this.getter()}}const Tt=n=>new xt(n),M=n=>new ge(n);class O{constructor(t,e){this.lower=t,this.upper=e}static default(){return new O(Tt(0),Tt(1))}static of(t,e){return new O(t,e)}setLimits(t,e){return this.lower=t,this.upper=e,this}range(){return this.upper.value()-this.lower.value()}normalize(t){return(t-this.lower.value())/this.range()}unnormalize(t){return t*this.range()+this.lower.value()}}const Ds=n=>({inner:{horizontal:O.default().setLimits(P(0),M(n.innerWidth)),vertical:O.default().setLimits(P(0),M(n.innerHeight))},outer:{horizontal:O.default().setLimits(M(n.innerLeft),M(n.innerRight)),vertical:O.default().setLimits(M(n.innerBottom),M(n.innerTop))},norm:{x:O.default().setLimits(M(n.normXLower),M(n.normXUppper)),y:O.default().setLimits(M(n.normYLower),M(n.normYUpper))},outerH:O.default().setLimits(M(n.innerLeft),M(n.innerRight)),outerV:O.default().setLimits(M(n.innerBottom),M(n.innerTop)),innerH:O.default().setLimits(P(0),M(n.innerWidth)),innerV:O.default().setLimits(P(0),M(n.innerHeight)),normX:O.default().setLimits(M(n.normXLower),M(n.normXUppper)),normY:O.default().setLimits(M(n.normYLower),M(n.normYUpper))}),Xs=()=>{const[n,t]=z(!1),[e,s]=z(0),[r,i]=z(0),[a,o]=z(!1),[h,p]=z(!1),[f,m]=z(0),[v,c]=z(0),[l,u]=z(0),[y,x]=z(0),{marginLines:k,labelFontsize:g}=X,b=I(k[0]*g),w=I(k[1]*g),$=I(k[2]*g),A=I(k[3]*g),S=()=>l()-w(),C=()=>e()-w()-A(),j=()=>r()-b()-$(),L=w,R=()=>e()-A(),q=b,Ht=()=>r()-$(),{x:lt,y:ct}=X.defaultNorm,[G,un]=z(lt.lower),[hn,fn]=z(lt.upper),[pn,dn]=z(ct.lower),[mn,yn]=z(ct.upper),[gn,vn]=z(1),[xn,wn]=z(0);return{active:n,width:e,height:r,rightButtonClicked:a,holding:h,mouseX:f,mouseY:v,clickX:l,clickY:y,innerWidth:C,innerHeight:j,innerLeft:L,innerRight:R,innerTop:Ht,innerBottom:q,marginBottom:b,marginLeft:w,marginTop:$,marginRight:A,innerClickX:S,normXLower:G,normXUppper:hn,normYLower:pn,normYUpper:mn,labelInterval:gn,labelCycle:xn,setActive:t,setWidth:s,setHeight:i,setRightButtonClicked:o,setHolding:p,setMouseX:m,setMouseY:c,setClickX:u,setClickY:x,setLabelInterval:vn,setLabelCycle:wn,setNormXLower:un,setNormXUpper:fn,setNormYLower:dn,setNormYUpper:yn}};class J{constructor(t,e,s){d(this,"unitNeat"),d(this,"breakWidth",()=>{const r=this.breaks();return this.pushforward(r[1])-this.pushforward(r[0])}),this.domain=t,this.norm=e,this.codomain=s}static default(){return new J(O.default(),O.default(),O.default())}pushforward(t){const{domain:e,norm:s,codomain:r}=this;return r.unnormalize(s.unnormalize(e.normalize(t)))}pullback(t){const{domain:e,norm:s,codomain:r}=this;return e.unnormalize(s.normalize(r.normalize(t)))}setDomain(t){return this.domain=t,this}setNorm(t){return this.norm=t,this}setCodomain(t){return this.codomain=t,this}breaks(t=4){let{domain:e,norm:s}=this;const[r,i]=[e.unnormalize(s.normalize(0)),e.unnormalize(s.normalize(1))],a=(i-r)/t,o=Math.floor(Math.log10(a)),h=[1,2,4,5,10];let[p,f]=[1/0,0];for(let y=0;y<h.length;y++){const x=(h[y]*10**o-a)**2;x<p&&([p,f]=[x,h[y]])}const m=10**o*f,v=Math.ceil(r/m)*m,c=Math.floor(i/m)*m,l=Math.round((c-v)/m),u=[parseFloat(v.toFixed(4))];for(let y=1;y<l;y++){const x=v+y*m;u.push(parseFloat(x.toFixed(4)))}return u.push(parseFloat(c.toFixed(4))),u}}class nt{constructor(t){this.values=t}static default(){return new nt(de([]))}static of(t){return new nt(t)}setValues(t){return this.values=t,this}normalize(t){const e=this.values.value();return(e.indexOf(t)+1)/(e.length+1)}unnormalize(t){const e=this.values.value();return e[Math.round(t*(e.length+1))-1]}}class ve{constructor(t,e,s){d(this,"setNorm",r=>(this.norm=r,this)),this.domain=t,this.norm=e,this.codomain=s}static default(){return new ve(nt.default(),O.default(),O.default())}pushforward(t){const{domain:e,norm:s,codomain:r}=this;return r.unnormalize(s.unnormalize(e.normalize(t)))}pullback(t){const{domain:e,norm:s,codomain:r}=this;return e.unnormalize(s.normalize(r.normalize(t)))}setDomain(t){return this.domain=t,this}setCodomain(t){return this.codomain=t,this}breaks(){return this.domain.values.value()}breakWidth(){const t=this.breaks();return this.pushforward(t[1])-this.pushforward(t[0])}}class K{constructor(t,e){this.norm=t,this.codomain=e}static default(){return new K(O.default(),O.default())}setNorm(t){return this.norm=t,this}setCodomain(t){return this.codomain=t,this}setLimits(t){return new J(t,this.norm,this.codomain)}setValues(t){return new ve(t,this.norm,this.codomain)}pushforward(){return 0}pullback(){}breaks(){return[]}breakWidth(){return 0}}const Ts=n=>{const{outerH:t,outerV:e,innerH:s,innerV:r,normX:i,normY:a}=n;return{inner:{pct:{x:J.default().setCodomain(s),y:J.default().setCodomain(r)},data:{x:K.default().setCodomain(s).setNorm(i),y:K.default().setCodomain(r).setNorm(a),size:K.default()}},outer:{pct:{x:J.default().setCodomain(t),y:J.default().setCodomain(e)},data:{x:K.default().setCodomain(t).setNorm(i),y:K.default().setCodomain(e).setNorm(a),size:K.default()}}}};function js(n){const{defaultNorm:t}=X;n.store.setNormXLower(t.x.lower),n.store.setNormYLower(t.y.lower),n.store.setNormXUpper(t.x.upper),n.store.setNormYUpper(t.y.upper)}function Rs(n){const{store:t,contexts:e,expanses:s}=n,[r,i,a,o]=[t.clickX(),t.clickY(),t.mouseX(),t.mouseY()],{innerH:h,innerV:p,normX:f,normY:m}=s;if(Math.abs(a-r)<10||Math.abs(o-i)<10)return;const[v,c]=Z([r,a]),[l,u]=Z([i,o]),y=f.normalize(h.normalize(v)),x=f.normalize(h.normalize(c)),k=m.normalize(p.normalize(l)),g=m.normalize(p.normalize(u)),b=1/(x-y),w=1/(g-k);St(()=>{t.setNormXLower(-y*b),t.setNormXUpper(-y*b+b),t.setNormYLower(-k*w),t.setNormYUpper(-k*w+w)}),n.scene.marker.clearTransient(),F(e.user)}function Ys(n){const{store:t,representations:e}=n,[s,r,i,a]=[t.mouseX(),t.mouseY(),t.innerHeight(),t.marginLeft()];let o;for(const p of e)o=Ve(p.queryAt(s,r)??{});let h="";for(const[p,f]of Object.entries(o??{}))h+=`${p}: ${f}<br>`;n.query.innerHTML=h,n.query.style.left=`${s+a}px`,n.query.style.top=`${i-r}px`,n.query.style.display="inline-block"}class Ut{constructor(t){d(this,"id"),d(this,"container"),d(this,"query"),d(this,"store"),d(this,"expanses"),d(this,"scales"),d(this,"contexts"),d(this,"representations"),d(this,"decorations"),d(this,"xTitle"),d(this,"yTitle"),d(this,"keyActions"),d(this,"pushRepresentation",o=>{this.representations.push(o);const h=o.keyActions;if(h)for(const[p,f]of tt(h)){const m=this.keyActions[p];this.keyActions[p]=m?Dn(m,f):f}Pt(()=>o.draw())}),d(this,"pushDecoration",o=>{this.decorations.push(o),Pt(()=>o.draw())}),d(this,"resize",()=>this.onResize()),d(this,"activate",()=>{this.store.setActive(!0),this.container.classList.add("active")}),d(this,"deactivate",()=>{this.query.style.display="none",this.store.setActive(!1),this.container.classList.remove("active"),F(this.contexts.user)}),d(this,"onResize",()=>{const{setWidth:o,setHeight:h}=this.store;o(Et(getComputedStyle(this.container).width)),h(Et(getComputedStyle(this.container).height));for(const p of this.representations)p.draw();for(const p of this.decorations)p.draw()}),d(this,"onMouseDown",o=>{const{height:h,marginBottom:p,marginLeft:f,setHolding:m,setClickX:v,setClickY:c,setMouseX:l,setMouseY:u}=this.store;this.query.innerText="";for(const g of this.scene.plots)g.id!=this.id&&g.deactivate();this.store.active()&&this.scene.marker.clearTransient(),this.activate();const y=o.offsetX-f(),x=h()-o.offsetY-p();m(!0),St(()=>{v(y),c(x),l(y),u(x)});const{setSelected:k}=this.scene.store;o.button===0&&this.representations.forEach(g=>k(g.checkSelection([y,x,y,x])))}),d(this,"onContextMenu",o=>{o.preventDefault(),this.store.setRightButtonClicked(!0)}),d(this,"onMouseUp",()=>{this.query.innerText="",this.store.setRightButtonClicked(!1),this.store.setHolding(!1)}),d(this,"onMouseMove",o=>{const{store:h,contexts:p,scene:f,representations:m}=this;if(!h.holding())return;const{height:v,marginLeft:c,marginBottom:l,setMouseX:u,setMouseY:y}=h,x=o.offsetX-c(),k=v()-o.offsetY-l();if(h.rightButtonClicked()){const{mouseX:L,mouseY:R,width:q,height:Ht}=h,lt=(x-L())/q(),ct=(k-R())/Ht();h.setNormXLower(G=>G+lt),h.setNormXUpper(G=>G+lt),h.setNormYLower(G=>G+ct),h.setNormYUpper(G=>G+ct),St(()=>{u(x),y(k)});return}const{clickX:g,clickY:b,mouseX:w,mouseY:$}=h,[A,S,C,j]=[g,w,b,$].map(Nn);F(p.user),et(p.user,A,C,S,j,{alpha:.25}),f.marker.clearTransient(),St(()=>{u(x),y(k)});for(const L of m)f.store.setSelected(L.checkSelection([A,C,S,j]))}),d(this,"onKeyDown",o=>{var h,p;this.store.active()&&((p=(h=this.keyActions)[o.code])==null||p.call(h))}),d(this,"onKeyUp",()=>{this.scene.store.setGroup(ht)}),this.scene=t,this.id=Symbol();const e=ce`<div
      class="plotscape-container"
    ></div>`;this.container=e,t.container.appendChild(e);const s=ce`<div
      class="plotscape-query"
    ></div>`;this.query=s,this.container.appendChild(s),window.addEventListener("resize",Qt(this.onResize,50)),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mousemove",Qt(this.onMouseMove,20)),window.addEventListener("keydown",Qt(this.onKeyDown,50));const r=Xs(),i=Ds(r),a=Ts(i);this.store=r,this.expanses=i,this.scales=a,this.contexts={};for(const o of Ns){const h={inner:o!="over",classes:[`${o}`]};this.contexts[o]=ye(this,h)}this.representations=[],this.decorations=[],this.xTitle="x",this.yTitle="y",this.pushDecoration(new Ne(this,"x")),this.pushDecoration(new Ne(this,"y")),this.pushDecoration(new Xe(this,"x")),this.pushDecoration(new Xe(this,"y")),this.keyActions={KeyR:()=>js(this),KeyZ:()=>Rs(this),KeyQ:()=>Ys(this)},t.pushPlot(this)}}const Vt={alpha:.5,color:X.transientColour};class Bs{constructor(t){d(this,"widthPct"),d(this,"setWidthPct"),d(this,"keyActions"),d(this,"draw",()=>{const{contexts:r,partData:i,scaleX:a,scaleY:o,breakWidthX:h}=this.adapter,p=this.widthPct(),f=i(2),m=h()*p;for(const v of bt)F(r[v]);for(const v of f){const c=a(v.x.value())-m/2,l=a(v.x.value())+m/2,u=o(v.y0.value()),y=o(v.y1.value()),x=v[dt].value(),k=v[pt].value(),g=v[mt].value(),b=r[k],w=X.groupColours[x-1];et(b,c,u,l,y,{alpha:1,color:w}),g&&et(b,c,u,l,y,Vt)}}),d(this,"checkSelection",r=>{const{partData:i,scaleX:a,scaleY:o,breakWidthX:h}=this.adapter,p=this.widthPct(),f=i(1),m=h()*p,v=[r[0],r[2]],c=[r[1],r[3]],l=new Set;for(const u of f){const y=a(u.x.value())-m/2,x=a(u.x.value())+m/2,k=o(u.y0.value()),g=o(u.y1.value());if(qt([y,x],[k,g],v,c))for(const b of u[U].value())l.add(b)}return l}),d(this,"queryAt",(r,i)=>{const{partData:a,scaleX:o,scaleY:h,breakWidthX:p}=this.adapter,f=this.widthPct(),m=a(1),v=p()*f;for(const c of m){const l=o(c.x.value())-v/2,u=o(c.x.value())+v/2,y=h(c.y0.value()),x=h(c.y1.value());if(Bt([r,i],[l,y,u,x]))return c}}),this.adapter=t;const[e,s]=z(X.width);this.widthPct=e,this.setWidthPct=s,this.keyActions={Equal:()=>this.setWidthPct(r=>Math.min(1,r*10/9)),Minus:()=>this.setWidthPct(r=>r*9/10),KeyR:()=>this.setWidthPct(X.width)}}}class Ft{constructor(t,e,s){d(this,"partData",r=>this.partitionSet.partData(r)),d(this,"scaleX",r=>this.scales.inner.data.x.pushforward(r)),d(this,"scaleY",r=>this.scales.inner.data.y.pushforward(r)),d(this,"scaleSize",r=>this.scales.inner.data.size.pushforward(r)),d(this,"breakWidthX",()=>this.scales.inner.data.x.breakWidth()),d(this,"breakWidthY",()=>this.scales.inner.data.y.breakWidth()),this.contexts=t,this.partitionSet=e,this.scales=s}}function qs(){return{reduced:!1,mapped:!1,stacked:!1,relabeled:!1}}class xe{constructor(t,e,s,r,i,a,o){this.reducefn=t,this.reduceinit=e,this.mapfn=s,this.stackfn=r,this.stackinit=i,this.relabelfn=a,this.state=o}static default(){return new xe(re,oe,se,re,oe,se,qs())}reduce(t,e){return this.reducefn=t,this.reduceinit=e,this.state.reduced=!0,this}map(t){return this.mapfn=t,this.state.mapped=!0,this}stack(t,e){return this.stackfn=t,this.stackinit=e,this.state.stacked=!0,this}relabel(t){return this.relabelfn=t,this.state.relabeled=!0,this}}class we{constructor(t,e){d(this,"variable"),d(this,"name"),d(this,"meta"),this.name=e?.name,this.variable=t.toVariable(),this.meta=this.variable.meta}static from(t,e){return new we(t,e)}empty(){}ith(){return this.variable.ith(I(0))}values(){return this.variable.values()}push(){return 1}isOfLength(){return!0}}class be{constructor(t,e,s,r){d(this,"trigger"),d(this,"setTrigger"),d(this,"reduced"),d(this,"mappedAndStacked"),d(this,"update",()=>this.setTrigger(void 0)),d(this,"nest",(o,h)=>{const{data:p,factor:f}=this;h=h??this.recipe;const m=()=>V.product(f(),o());return new be(m,p,h,this)}),d(this,"reduce",()=>{this.trigger();const{data:o,parent:h,recipe:p}=this;if(!p.state.reduced){const w={},$=this.factor().data().cols;for(const A of Y($))w[A]=$[A];for(const A of Y(o.cols))w[A]=o.cols[A];return N.from(o.n,w)}const f=this.factor(),m=f.indices(),v=h?W(h.factor):void 0,c=v?.indices(),l={},u={},y=ut.from(o,0);let x=c?.next();for(const w of m)l[w]||(l[w]=p.reduceinit(),u[w]=x?.value),l[w]=p.reducefn(l[w],y.values()),x=c?.next(),y.slide();const k=B.from(Object.values(u)),g=N.fromRows(Object.values(l)),b=f.data();h&&g.appendCol(Jt,k);for(const[w,$]of tt(b.cols))g.appendCol(w,$);return g}),d(this,"mapAndStack",()=>{const{recipe:o,parent:h}=this,p=this.reduced(),f=W(this.factor);if(!h){const k=o.mapfn(p.row(I(0))),g=N.fromRows([k]);for(const b of Lt)b in p.cols&&g.appendCol(b,p.cols[b]);return g}const m=h?W(h.mapAndStack):void 0,v=m?.rows(),c=ut.from(p,0);if(!o.state.stacked){const k={};for(const b of Y(c.values()))k[b]=Yn();let g=!0;try{o.mapfn(k)}catch{g=!1}if(g){const b=o.mapfn(p.cols);for(const $ of Y(b))Bn(b[$])&&(b[$]=we.from(b[$]));const w=N.from(p.n,b);for(const $ of Lt)$ in p.cols&&w.appendCol($,p.cols[$]);return w}}const l=c.values();l.parent=v[l[Jt].value()];const u=o.mapfn(l),y={};for(const k of Y(u))y[k]=u[k].toVariable();const x=N.from(1,y).empty();for(const k of f.uniqueIndices()){const g=c.values();if(!v){x.push(o.mapfn(g)),c.slide();continue}const b=g[Jt].value(),w=v[b];g.parent=w;const $=o.mapfn(g);if(!o.state.stacked){x.push($),c.slide();continue}w[kt]||(w[kt]=o.stackinit());const A=o.stackfn(w[kt],$);v[b][kt]=A,x.push(Object.assign($,A)),c.slide()}for(const k of Lt)k in p.cols&&x.appendCol(k,p.cols[k]);return x}),this.factor=t,this.data=e,this.recipe=s,this.parent=r;const[i,a]=z(void 0,{equals:!1});this.trigger=i,this.setTrigger=a,this.reduced=ne(()=>this.reduce()),this.mappedAndStacked=ne(()=>this.mapAndStack())}}class Gt{constructor(t,e){d(this,"partitions"),d(this,"recipes"),d(this,"reduceAt",(s,r,i)=>(this.recipes[s].reduce(r,i),this)),d(this,"partData",s=>this.partitions[s].mappedAndStacked()),d(this,"update",()=>{const{factors:s,data:r,recipes:i}=this;if(!this.partitions.length){let a=new be(s[0],r,i[0]);this.partitions.push(a);for(let o=1;o<this.factors.length;o++)a=a.nest(s[o],i[o]),this.partitions.push(a)}for(const a of this.partitions)a.update();return this}),this.factors=t,this.data=e,this.partitions=[],this.recipes=[];for(const s of t)this.recipes.push(xe.default())}apply(t){return t(this),this}reduce(t,e){for(const s of this.recipes)s.reduce(t,e);return this}mapAt(t,e){return this.recipes[t].map(e),this}map(t){for(const e of this.recipes)e.map(t);return this}stackAt(t,e,s){return this.recipes[t].stack(e,s),this}stack(t,e){for(const s of this.recipes)s.stack(t,e);return this}}function Is(n){return n.map(({var1:t,var2:e})=>({x:t,y:e})).update()}function Ws(n){return n.reduce(({count:t},{})=>({count:t.inc()}),()=>({count:P(0)})).map(({label:t,count:e})=>({x:t,y0:P(0),y1:e})).stackAt(2,(t,e)=>({y0:t.y1,y1:t.y1.add(e.y1)}),()=>({y0:P(0),y1:P(0)})).update()}function Te(n){return n.reduce(({summary1:t},e)=>({summary1:t.inc()}),()=>({summary1:P(0)})).map(({bin0:t,bin1:e,summary1:s})=>({x0:t,x1:e,y0:P(0),y1:s})).stackAt(1,re,oe).stackAt(2,(t,e)=>({y0:t.y1,y1:t.y1.add(e.y1)}),()=>({y0:P(0),y1:P(0)})).update()}function Us(n){return n.reduce(({summary1:t},e)=>({summary1:t.inc()}),()=>({summary1:P(0)})).mapAt(0,({summary1:t})=>({x1:t})).mapAt(1,({summary1:t})=>({x0:P(0),x1:t,y0:P(0),y1:P(1),summary1:t})).mapAt(2,({summary1:t,parent:e})=>({x0:e.x0,x1:e.x1,y0:P(0),y1:t.divideBy(e.summary1)})).stackAt(1,(t,e)=>({x0:t.x1,x1:t.x1.add(e.x1)}),()=>({x1:P(0)})).stackAt(2,(t,e)=>({y0:t.y1,y1:t.y1.add(e.y1)}),()=>({y0:P(0),y1:P(0)})).update()}function Vs(n){return n.reduce(({count:t},{})=>({count:t.inc()}),()=>({count:P(0)})).map(({label:t,label$:e,count:s})=>({x:t,y:e,size:s})).stackAt(2,(t,e)=>({size:t.size.add(e.size)}),()=>({size:P(0)})).update()}class Fs{constructor(t,e){d(this,"data"),d(this,"factors"),d(this,"plot"),d(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new Ut(t),this.data=t.data.select(e),this.plot.xTitle=ot(this.data.cols.var1.name??"")??"x",this.plot.yTitle="Count";const{data:s,plot:r}=this,[i,a]=z(void 0),o=()=>V.mono(t.data.n),h=()=>s.cols.var1.factor(i()),p=t.marker.factor;this.factors=[o,h,p],this.partitionSet=new Gt(this.factors,s).apply(Ws);const f=()=>this.partitionSet.partData(1),m=M(()=>f().cols.x.values()),v=M(()=>f().cols.y1.meta.max);for(const g of fe(r.scales))g.data.x=g.data.x.setValues(nt.of(m)),g.data.y=g.data.y.setLimits(O.of(P(0),v));this.plot.store.setNormYLower=Ue;const c=()=>f().cols.y1.values(),l=()=>s.cols.var1.meta.values,u=()=>Tn(l(),c());let y=!1;Object.assign(this.plot.keyActions,{KeyO:()=>{y?(a(l()),y=!1):(a(u()),y=!0)}});const x=new Ft(r.contexts,this.partitionSet,r.scales),k=new Bs(x);r.pushRepresentation(k)}}class Gs{constructor(t){this.adapter=t}draw(){const{contexts:t,partData:e,scaleX:s,scaleY:r,scaleSize:i,breakWidthX:a,breakWidthY:o}=this.adapter,h=e(2),p=Math.min(a(),o())/2;for(const f of bt)F(t[f]);for(const f of h){const m=s(f.x.value()),v=r(f.y.value()),c=i(f.size.value())*p,l=f[dt].value(),u=f[pt].value(),y=f[mt].value(),x=t[u],k=X.groupColours[l-1],g=m-c,b=m+c,w=v-c,$=v+c;et(x,g,w,b,$,{alpha:1,color:k}),y&&et(x,g,w,b,$,Vt)}}checkSelection(t){const{partData:e,scaleX:s,scaleY:r,scaleSize:i,breakWidthX:a,breakWidthY:o}=this.adapter,h=e(1),p=Math.min(a(),o())/2,f=[t[0],t[2]],m=[t[1],t[3]],v=new Set;for(const c of h){const l=s(c.x.value()),u=r(c.y.value()),y=i(c.size.value())*p,x=l-y,k=l+y,g=u-y,b=u+y;if(qt([x,k],[g,b],f,m))for(const w of c[U].value())v.add(w)}return v}queryAt(t,e){const{partData:s,scaleX:r,scaleY:i,scaleSize:a,breakWidthX:o,breakWidthY:h}=this.adapter,p=s(1),f=Math.min(o(),h())/2;for(const m of p){const v=r(m.x.value()),c=i(m.y.value()),l=a(m.size.value())*f,u=v-l,y=v+l,x=c-l,k=c+l;if(Bt([t,e],[u,x,y,k]))return m}}}class jt{constructor(t,e,s){this.lower=t,this.upper=e,this.trans=s}static default(){return new jt(Tt(0),Tt(1),se)}static of(t,e,s){return new jt(t,e,s)}setLimits(t,e){return this.lower=t,this.upper=e,this}range(){return this.trans(this.upper.value())-this.trans(this.lower.value())}normalize(t){return(this.trans(t)-this.trans(this.lower.value()))/this.range()}unnormalize(t){return t*this.range()+this.lower.value()}}class Hs{constructor(t,e){d(this,"data"),d(this,"factors"),d(this,"plot"),d(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new Ut(t),this.data=t.data.select(e),this.plot.xTitle=ot(this.data.cols.var1.name??"")??"x",this.plot.yTitle=ot(this.data.cols.var2.name??"")??"y";const{data:s,plot:r}=this,i=()=>V.mono(t.data.n),a=()=>V.product(s.cols.var1.factor(),s.cols.var2.factor()),o=t.marker.factor;this.factors=[i,a,o],this.partitionSet=new Gt(this.factors,s).apply(Vs);const h=()=>this.partitionSet.partData(1),p=M(()=>h().cols.x.values()),f=M(()=>h().cols.y.values()),m=M(()=>h().cols.size.meta.max);for(const l of fe(r.scales))l.data.x=l.data.x.setValues(nt.of(p)),l.data.y=l.data.y.setValues(nt.of(f)),l.data.size=l.data.size.setLimits(jt.of(P(0),m,Math.sqrt));const v=new Ft(r.contexts,this.partitionSet,r.scales),c=new Gs(v);r.pushRepresentation(c)}}class Ks{constructor(t){d(this,"draw",()=>{const{contexts:e,partData:s,scaleX:r,scaleY:i}=this.adapter,a=s(2);for(const o of bt)F(e[o]);for(const o of a){const h=r(o.x0.value()),p=r(o.x1.value()),f=i(o.y0.value()),m=i(o.y1.value()),v=o[dt].value(),c=o[pt].value(),l=o[mt].value(),u=e[c],y=X.groupColours[v-1];et(u,h,f,p,m,{alpha:1,color:y}),l&&et(u,h,f,p,m,Vt)}}),d(this,"checkSelection",e=>{const{partData:s,scaleX:r,scaleY:i}=this.adapter,a=s(1),o=[e[0],e[2]],h=[e[1],e[3]],p=new Set;for(const f of a){const m=r(f.x0.value()),v=r(f.x1.value()),c=i(f.y0.value()),l=i(f.y1.value());if(qt([m,v],[c,l],o,h))for(const u of f[U].value())p.add(u)}return p}),d(this,"queryAt",(e,s)=>{const{partData:r,scaleX:i,scaleY:a}=this.adapter,o=r(1);for(const h of o){const p=i(h.x0.value()),f=i(h.x1.value()),m=a(h.y0.value()),v=a(h.y1.value());if(Bt([e,s],[p,m,f,v]))return h}}),this.adapter=t}}class Zs{constructor(t,e){d(this,"plot"),d(this,"data"),d(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new Ut(t),this.data=t.data.select(e),this.plot.xTitle=ot(this.data.cols.var1.name??"")??"x",this.plot.yTitle="Count";const{data:s,plot:r}=this,{keyActions:i}=r,{min:a,max:o}=s.cols.var1.meta,h=o-a,[p,f]=z(h/20),[m,v]=z(a);i.Equal=()=>f(S=>S*10/9),i.Minus=()=>f(S=>S*9/10),i.BracketRight=()=>v(S=>S+1),i.BracketLeft=()=>v(S=>S-1);const c=()=>V.mono(s.n),l=()=>s.cols.var1.bin(M(p),M(m)),u=t.marker.factor,y=[c,l,u];this.partitionSet=new Gt(y,s).apply(Te);const x=()=>this.partitionSet.partData(1),k=M(()=>x().cols.x0.meta.min),g=M(()=>x().cols.x1.meta.max),b=M(()=>x().cols.y1.meta.max);for(const S of Object.values(r.scales))S.data.x=S.data.x.setLimits(O.of(k,g)),S.data.y=S.data.y.setLimits(O.of(P(0),b));let w=!1;i.KeyS=()=>{w?(this.partitionSet.apply(Te),w=!1):(this.partitionSet.apply(Us),w=!0)},this.plot.store.setNormYLower=Ue;const $=new Ft(r.contexts,this.partitionSet,r.scales),A=new Ks($);r.pushRepresentation(A)}}class Qs{constructor(t){d(this,"radiusMult"),d(this,"setRadiusMult"),d(this,"keyActions"),d(this,"draw",()=>{const{contexts:r,partData:i,scaleX:a,scaleY:o}=this.adapter,h=this.radiusMult(),{radius:p}=X,f=i(2),m=p*h;for(const c of bt)F(r[c]);const{height:v}=r.base.canvas.getBoundingClientRect();for(const c of f){const l=a(c.x.value()),u=o(c.y.value()),y=c[dt].value(),x=c[pt].value(),k=c[mt].value(),g=r[x],b=X.groupColours[y-1];ke(g,l,v-u,{radius:m,color:b}),k&&ke(g,l,v-u,{...Vt,radius:m})}}),d(this,"checkSelection",r=>{const{partData:i,scaleX:a,scaleY:o}=this.adapter,h=this.radiusMult(),p=i(1),f=[r[0],r[2]],m=[r[1],r[3]],v=new Set,c=Math.sqrt(2);for(const l of p){const u=a(l.x.value()),y=o(l.y.value()),x=[u-c*h,u+c*h],k=[y-c*h,y+c*h];if(qt(x,k,f,m))for(const g of l[U].value())v.add(g)}return v}),d(this,"queryAt",(r,i)=>{const{partData:a,scaleX:o,scaleY:h}=this.adapter,p=this.radiusMult(),f=a(1),m=Math.sqrt(2);for(const v of f){const c=o(v.x.value()),l=h(v.y.value()),u=c-m*p,y=c+m*p,x=l-m*p,k=l+m*p;if(Bt([r,i],[u,x,y,k]))return v}}),this.adapter=t;const[e,s]=z(1);this.radiusMult=e,this.setRadiusMult=s,this.keyActions={Equal:()=>this.setRadiusMult(r=>r*10/9),Minus:()=>this.setRadiusMult(r=>r*9/10),KeyR:()=>this.setRadiusMult(1)}}}class Js{constructor(t,e){d(this,"data"),d(this,"plot"),d(this,"partitionSet"),this.scene=t,this.mappingfn=e,this.plot=new Ut(t),this.data=t.data.select(e),this.plot.xTitle=ot(this.data.cols.var1.name??"")??"x",this.plot.yTitle=ot(this.data.cols.var2.name??"")??"y";const{data:s,plot:r}=this,i=()=>V.mono(t.data.n),a=()=>V.iso(t.data.n),o=t.marker.factor,h=[i,a,o];this.partitionSet=new Gt(h,s).apply(Is);const p=()=>this.partitionSet.partData(1),f=M(()=>p().cols.x.meta.min),m=M(()=>p().cols.x.meta.max),v=M(()=>p().cols.y.meta.min),c=M(()=>p().cols.y.meta.max);for(const y of fe(r.scales))y.data.x=y.data.x.setLimits(O.of(f,m)),y.data.y=y.data.y.setLimits(O.of(v,c));const l=new Ft(r.contexts,this.partitionSet,r.scales),u=new Qs(l);r.pushRepresentation(u)}}const _s=await jn("https://raw.githubusercontent.com/bartonicek/plotscape5/master/public/mpg.json"),tr={cyl:"discrete",manufacturer:"discrete",hwy:"numeric",displ:"numeric",year:"discrete"},er=N.parseCols(_s,tr),nr=document.querySelector("#app");An(()=>{const n=new rs(nr,er);new Fs(n,t=>({var1:t.manufacturer})),new Zs(n,t=>({var1:t.hwy})),new Js(n,t=>({var1:t.displ,var2:t.hwy})),new Hs(n,t=>({var1:t.year,var2:t.cyl}))});
